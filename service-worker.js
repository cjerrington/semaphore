(()=>{"use strict";function t(t,e,s){const n={method:t,headers:Object.assign(e||{},{Accept:"application/json"})};return s&&s.signal&&(n.signal=s.signal),n}async function e(t,e,s){let n;return n=s&&s.timeout?await function(t,e,s){return new Promise(((n,a)=>{fetch(t,e).then(n,a),setTimeout((()=>a(new Error(`Timed out after ${s/1e3} seconds`))),s)}))}(t,e,s.timeout):await fetch(t,e),async function(t){if(t.status>=300){const e=new Error("Request failed: "+t.status);throw e.status=t.status,e}const e=await t.json();if(t.status>=200&&t.status<300)return{json:e,headers:t.headers};if(e&&e.error)throw new Error(t.status+": "+e.error);throw new Error("Request failed: "+t.status)}(n)}async function s(s,n,a,i,c){const o=t(s,i,c);return a&&(a instanceof FormData||a instanceof URLSearchParams?o.body=a:(o.body=JSON.stringify(a),o.headers["Content-Type"]="application/json")),e(n,o,c)}async function n(t,e,n,a){return(await s("POST",t,e,n,a)).json}const a={addEventListener:function(t,e){0},removeEventListener:function(t,e){0}};class i{constructor(t="keyval-store",e="keyval"){this.storeName=e,this._dbName=t,this._storeName=e,this._init()}_withIDBStore(t,e){return this._init(),this._dbp.then((s=>new Promise(((n,a)=>{const i=s.transaction(this.storeName,t);i.oncomplete=()=>n(),i.onabort=i.onerror=()=>a(i.error),e(i.objectStore(this.storeName))}))))}_init(){this._dbp||(this._dbp=new Promise(((t,e)=>{const s=indexedDB.open(this._dbName,1);s.onerror=()=>e(s.error),s.onsuccess=()=>t(s.result),s.onupgradeneeded=()=>{s.result.createObjectStore(this._storeName)}})))}_close(){return this._init(),this._dbp.then((t=>{t.close(),this._dbp=void 0}))}}let c;function o(){return c||(c=new i),c}function r(){return o()._close()}a.addEventListener("statechange",(async t=>{"frozen"===t.newState&&await r()}));function l(t){return e="web-share-data",s=t,o()._withIDBStore("readwrite",(t=>{t.put(s,e)}));var e,s}const f="known-instance-";async function d(){return(await function(){const t=o(),e=[];return t._withIDBStore("readonly",(t=>{(t.openKeyCursor||t.openCursor).call(t).onsuccess=function(){this.result&&(e.push(this.result.key),this.result.continue())}})).then((()=>e))}()).filter((t=>t.startsWith(f))).map((t=>t.substring(f.length)))}const b="assets_1699904721332",p="webpack_assets_1699904721332",u=[{regex:/tesseract-core\.wasm/,cache:p},{regex:/traineddata\.gz/,cache:b},{regex:/\$polyfill\$/,cache:p},{regex:/TwemojiCountryFlags\.woff2/,cache:b},{regex:/_splash\.png$/,cache:b}],h=["/service-worker-index.html","TwemojiCountryFlags.woff2","apple-icon.png","emoji-en-US.json","eng.traineddata.gz","favicon-alert.png","favicon.png","icon-144-maskable.png","icon-144.png","icon-150.png","icon-192-maskable.png","icon-192.png","icon-44.png","icon-48-maskable.png","icon-48.png","icon-50.png","icon-512-maskable.png","icon-512.png","icon-72-maskable.png","icon-72.png","icon-96-maskable.png","icon-96.png","icon-push-badge.png","icon-push-fa-retweet.png","icon-push-fa-star.png","icon-shortcut-fa-bell.png","icon-shortcut-fa-pencil.png","icons.svg","inline-script.js.map","ipad_splash.png","ipadpro1_splash.png","ipadpro2_splash.png","ipadpro3_splash.png","iphone5_splash.png","iphone6_splash.png","iphoneplus_splash.png","iphonex_splash.png","iphonexr_splash.png","iphonexsmax_splash.png","manifest.json","screenshot-540-720-1.png","screenshot-540-720-2.png","screenshot-540-720-3.png","theme-cobalt.css","theme-dark-grayscale.css","theme-gecko.css","theme-grayscale.css","theme-hacker.css","theme-hotpants.css","theme-majesty.css","theme-mastodon.css","theme-oaken.css","theme-ozark.css","theme-pitchblack.css","theme-punk.css","theme-riot.css","theme-scarlet.css","theme-seafoam.css","theme-sorcery.css"].map((t=>t.startsWith("/")?t:`/${t}`)).filter((t=>!t.endsWith(".map"))).filter((t=>"/robots.txt"!==t)).filter((t=>!t.includes("traineddata.gz"))).filter((t=>!t.endsWith(".webapp"))).filter((t=>!/emoji-.*?\.json$/.test(t))).filter((t=>!/screenshot-.*?\.png/.test(t))).filter((t=>!/TwemojiCountryFlags\.woff2/.test(t))).filter((t=>!/_splash\.png$/.test(t))),g=["client/tesseract-asset.e4db7f953ac7bcf9f67bd39031e42241.tesseract-core.wasm.js","client/7231.dae003acd7bde719b598.7231.js","client/5332.294800c4f6c7fd2a3f81.$polyfill$-internationalization.js","client/2644.18340238ba9ef6637f4a.2644.js","client/tesseract-asset.659051bf21f04d23ef64f43306ff257c.worker.min.js","client/179.70cdffab439536a5f996.main.js","client/2034.a9e28dcf8564cbdd953f.2034.js","client/4026.c417d0287f101fb4407b.4026.js","client/7434.e7274089fe4db529ec44.settings_instances_$instanceName.js","client/3274.d196fed8af8b1c650b43.3274.js","client/8945.b268fe70159a01a5c885.8945.js","client/135.cd91945c25bd68102174.135.js","client/2284.46e3cd4754f09de1291f.2284.js","client/4977.11234c4684362e0d1ad7.4977.js","client/7727.e84db896bea14e649076.7727.js","client/9587.b28938fbfa96a681df9b.community.js","client/3976.070b838e587a39c1daf2.settings_general.js","client/8619.ae2a851a8e299ea81c78.8619.js","client/6464.386acbfe9689a596e25c.search.js","client/279.a842aa973a65223f13e8.279.js","client/4970.742cfae2d5d703d639b6.4970.js","client/4285.f25d6689d17ddcbf37c9.4285.js","client/4549.6b2df1cbdb21b438b8ef.settings_wellness.js","client/3754.037f4c59dea116fc9d09.settings_instances_add.js","client/7080.daeb3faaf37f03e5705c.7080.js","client/7666.0d90fb86d88812ec70b3.7666.js","client/4826.1539b15bb276004ffd33.index.js","client/2936.ba2d083789953ed13811.2936.js","client/268.4c4534e115185c31b887.268.js","client/9117.207d466a6595172f2257.9117.js","client/8289.6229051062c5fc074083.8289.js","client/8083.ff7a8705e956ee55be86.8083.js","client/3999.76f88a5dc66f2029bf1a.3999.js","client/8651.3e41cd73ab8ad265853c.settings_instances.js","client/2159.f7f2849cd3e3ce0039bd.2159.js","client/1212.ab73fb6b1d0b36c0f7c2.1212.js","client/4990.807947add4f75dff3459.pinned.js","client/3948.cd39309d0c10c3a94d7b.3948.js","client/2346.6eedba68d14b5973d598.settings_hotkeys.js","client/2744.e16c2476cbdb4f19c70b.2744.js","client/7323.5eb905bd2677529397af.7323.js","client/1170.a1a34d2819c76262ed6b.1170.js","client/1277.03fbca5dc44747e7d415.1277.js","client/9418.d7b8150ecb6b2e8080a2.9418.js","client/2683.de19d9e69bd092fd48c2.2683.js","client/3660.c22a142e4816087d3163.blocked.js","client/1617.e9fa67671d35b85f226c.muted.js","client/1909.2d1c7b5291d9ff3557c2.notifications.js","client/3757.9de35079d521eeb0e65f.3757.js","client/3084.1597c224dd09be5b3d72.3084.js","client/3863.2c1686a67902f9ef0791.3863.js","client/5980.f7836850bdc7bbde7ccf.notifications_mentions.js","client/3517.c3932610f2817bf13d8f.3517.js","client/1915.18ca4e9150b27a595377.1915.js","client/9499.40a930f5a174c550206c.9499.js","client/5571.56b542587a74296ed0c8.settings.js","client/1216.8333da3f7b2d6feec5fc.requests.js","client/7427.ab603d7e31ffb021542e.7427.js","client/881.3d8497961ad1ec91d5f5.lists_$listId.js","client/7438.551eedf52780fb6c0d81.7438.js","client/1095.58c0c959e6343c506c69.1095.js","client/3393.78963cd4a6f93a2beab1.3393.js","client/8565.5359c34a2bc4a2b1baf2.8565.js","client/1225.e33e64a0ac67dce5baf4.settings_about.js","client/blurhash.ef9e7ca2b2b022bba07d.blurhash.js","client/1240.ce16c4e80ff9dae061a9.direct.js","client/392.bdb6b193ceeb27c8323d.federated.js","client/2889.d898645c243222cd10b9.accounts_$accountId_followers.js","client/2615.c38b732b09a90d2ed6a3.bookmarks.js","client/205.fe5e0d5096e388b2e1d7.favorites.js","client/4827.3544beab58e570100c2f.accounts_$accountId_follows.js","client/9446.88908a9b4c2d78c3e5f4.local.js","client/5291.5bb0187bd9476838550f.5291.js","client/733.f3aa352bbfe80717db99.tags_$tagName.js","client/8309.726489cc79baec40c159.8309.js","client/2623.f1af696def770d9202ff.2623.js","client/5853.4ced2d11ba12beb0b4e9.$polyfill$-focus-visible.js","client/4016.0383f10ce330169a7090.statuses_$statusId.js","client/1785.cfb003186ecbba32c6d9.1785.js","client/6610.4fda282bb6f6a600e512.6610.js","client/6949.5bd884d1c3e383836fb0.6949.js","client/8742.46ce067dbc90afb19498.statuses_$statusId_favorites.js","client/3365.4310e40a76037ee7902e.statuses_$statusId_reblogs.js","client/9225.b0b2df5503a95899d290.9225.js","client/7807.6673f19c4a65d58ccc84.7807.js","client/1298.348978b4e54dd9665ede.1298.js","client/3306.9cd8ec3aba5b676fb019.3306.js","client/2307.4f07cc1e50d4e3f16719.2307.js","client/7542.2ca67214917eef091868.7542.js","client/8504.ba9b2a375a8a8f7e1484.8504.js","client/7539.4ceb539ade5fb3e4905e.7539.js","client/9668.99d5f19f1cec393ce92e.$polyfill$-requestidlecallback.js","client/1362.50037e942cf318330643.1362.js","client/8688.e77a7f723b74121107f6.accounts_$accountId_with_replies.js","client/3864.8ce2055f086df4198bb5.accounts_$accountId_media.js","client/2270.d5776412e21e62cb45f5.accounts_$accountId.js","client/5565.5bb099bc859de102e68e.5565.js","client/5246.b6308c58940718b6d8aa.5246.js","client/4292.47763cc7159fded7add5.4292.js","client/1793.629d26e75b51aa1eb876.1793.js","client/6374.4542981efea45833338e.$polyfill$-dynamic-viewport-units.js","client/40.87c3bcf711e9a3676096.40.js","client/7553.000c8442e92aa5e54ad7.7553.js"].filter((t=>!t.endsWith(".map"))).filter((t=>!t.includes("tesseract-core.wasm"))).filter((t=>!t.includes("LICENSE"))).filter((t=>!t.includes("$polyfill$"))),j=[{pattern:/^\/?$/},{pattern:/^\/notifications\/?$/},{pattern:/^\/notifications\/mentions\/?$/},{pattern:/^\/bookmarks\/?$/},{pattern:/^\/community\/?$/},{pattern:/^\/favorites\/?$/},{pattern:/^\/federated\/?$/},{pattern:/^\/accounts\/([^\/]+?)\/?$/},{pattern:/^\/accounts\/([^\/]+?)\/with_replies\/?$/},{pattern:/^\/accounts\/([^\/]+?)\/followers\/?$/},{pattern:/^\/accounts\/([^\/]+?)\/follows\/?$/},{pattern:/^\/accounts\/([^\/]+?)\/media\/?$/},{pattern:/^\/requests\/?$/},{pattern:/^\/settings\/?$/},{pattern:/^\/settings\/instances\/?$/},{pattern:/^\/settings\/instances\/add\/?$/},{pattern:/^\/settings\/instances\/([^\/]+?)\/?$/},{pattern:/^\/settings\/wellness\/?$/},{pattern:/^\/settings\/general\/?$/},{pattern:/^\/settings\/hotkeys\/?$/},{pattern:/^\/settings\/about\/?$/},{pattern:/^\/statuses\/([^\/]+?)\/?$/},{pattern:/^\/statuses\/([^\/]+?)\/favorites\/?$/},{pattern:/^\/statuses\/([^\/]+?)\/reblogs\/?$/},{pattern:/^\/blocked\/?$/},{pattern:/^\/direct\/?$/},{pattern:/^\/pinned\/?$/},{pattern:/^\/search\/?$/},{pattern:/^\/lists\/([^\/]+?)\/?$/},{pattern:/^\/local\/?$/},{pattern:/^\/muted\/?$/},{pattern:/^\/tags\/([^\/]+?)\/?$/}];async function w(t){await self.registration.showNotification(t.title,{badge:"/icon-push-badge.png",icon:t.icon,body:t.body,tag:t.notification_id,data:{url:`${self.origin}/notifications`}})}self.addEventListener("install",(t=>{t.waitUntil((async()=>{await Promise.all([caches.open(p).then((t=>t.addAll(g))),caches.open(b).then((t=>t.addAll(h)))]),self.skipWaiting()})())})),self.addEventListener("activate",(t=>{t.waitUntil((async()=>{const t=await caches.keys();for(const s of t)s===b||s.startsWith("webpack_assets_")||await caches.delete(s);const e=t.filter((t=>t.startsWith("webpack_assets_"))).sort(((t,e)=>{const s=parseInt(t.substring(15),10);return parseInt(e.substring(15),10)<s?-1:1})).slice(2);for(const s of e)await caches.delete(s);await self.clients.claim()})())})),self.addEventListener("fetch",(t=>{const e=t.request,s=new URL(e.url);s.protocol.startsWith("http")&&t.respondWith((async()=>{if(s.origin===self.origin){if("POST"===e.method&&"/share"===s.pathname){const t=await e.formData(),s=t.get("title"),n=t.get("text"),a=t.get("url"),i=t.get("file");return await l({title:s,text:n,url:a,file:i}),await r(),Response.redirect("/?pwa=true&compose=true",303)}const t=await caches.match(e);if(t)return t;for(const{regex:n,cache:a}of u)if(n.test(s.pathname)){const t=await fetch(e);if(t&&t.status>=200&&t.status<300){const s=t.clone();caches.open(a).then((t=>t.put(e,s)))}return t}if(j.find((t=>t.pattern.test(s.pathname)))){const t=await caches.match("/service-worker-index.html");if(t)return t}}return fetch(e)})())})),self.addEventListener("push",(s=>{s.waitUntil((async()=>{const n=s.data.json(),a=await d();if(1!==a.length)return void(await w(n));const i=function(t){return t.startsWith("localhost:")||t.startsWith("127.0.0.1:")}(c=a[0])?`http://${c}`:`https://${c}`;var c;try{const s=await async function(s,n,a){return(await e(s,t("GET",n,a),a)).json}(`${i}/api/v1/notifications/${n.notification_id}`,{Authorization:`Bearer ${n.access_token}`},{timeout:2e3});await async function(t,e){const{icon:s,body:n}=t,a=e.id,{origin:i}=self.location,c="/icon-push-badge.png";switch(e.type){case"follow":case"follow_request":case"admin.report":case"admin.sign_up":await self.registration.showNotification(t.title,{badge:c,icon:s,body:n,tag:a,data:{url:`${i}/accounts/${e.account.id}`}});break;case"reblog":case"favourite":case"status":case"poll":await self.registration.showNotification(t.title,{badge:c,icon:s,body:n,tag:a,data:{url:`${i}/statuses/${e.status.id}`}});break;case"mention":{const o=[["public","unlisted"].includes(e.status.visibility)&&{action:"reblog",icon:"/icon-push-fa-retweet.png",title:"Boost"},{action:"favourite",icon:"/icon-push-fa-star.png",title:"Favorite"}].filter(Boolean);await self.registration.showNotification(t.title,{badge:c,icon:s,body:n,tag:a,data:{instance:new URL(t.icon).origin,status_id:e.status.id,access_token:t.access_token,url:`${i}/statuses/${e.status.id}`},actions:o});break}}}(n,s)}catch(o){await w(n)}})())}));const m=(t,e)=>{const s=(t=>{const e={};for(const s in t)"function"!=typeof t[s]&&null!==t[s]&&(e[s]=t[s]);return e})(t);return s.actions=s.actions.filter((t=>t.action!==e)),self.registration.showNotification(s.title,s)};self.addEventListener("notificationclick",(t=>{t.waitUntil((async()=>{switch(t.action){case"reblog":{const e=`${t.notification.data.instance}/api/v1/statuses/${t.notification.data.status_id}/reblog`;await n(e,null,{Authorization:`Bearer ${t.notification.data.access_token}`}),await m(t.notification,"reblog");break}case"favourite":{const e=`${t.notification.data.instance}/api/v1/statuses/${t.notification.data.status_id}/favourite`;await n(e,null,{Authorization:`Bearer ${t.notification.data.access_token}`}),await m(t.notification,"favourite");break}default:await self.clients.openWindow(t.notification.data.url),await t.notification.close()}})())})),self.addEventListener("message",(t=>{if("skip-waiting"===t.data)self.skipWaiting()}))})();
//# sourceMappingURL=service-worker.js.map