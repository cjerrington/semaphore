{"version":3,"file":"7080.daeb3faaf37f03e5705c.7080.js","mappings":"sMA4Na,CACPA,WAAYC,GACV,MAAM,GAAEC,GAAOC,KAAKC,MAChBH,IAAYC,GAKhBG,YAAW,KACTC,uBAAsB,KACpBC,OAAOC,iBAAiB,WAAYL,KAAKM,YACzCN,KAAKO,IAAI,CAAEC,aAAa,IACxBJ,OAAOK,QAAQC,UAAU,CAAEC,MAAOZ,GAAM,KAAMa,SAASC,MACvDC,SAASC,KAAKC,UAAUC,OAAO,cAAc,GAC7CjB,KAAKkB,YAAYC,OACjBnB,KAAKO,IAAI,CAAEa,SAAS,IACpBpB,KAAKqB,KAAK,SACV,OAAK,kBAAmBtB,EAAE,GAC3B,GAET,EACIO,WAAYgB,GACV,MAAM,GAAEvB,GAAOC,KAAKC,MACdqB,EAAMC,OAASD,EAAMC,MAAMZ,QAAUZ,IAGzCC,KAAKO,IAAI,CAAEiB,aAAa,IACxBxB,KAAKyB,YAAY1B,GAEzB,EACI0B,YAAa3B,GACX,MAAM,GAAEC,GAAOC,KAAKC,MAChBF,IAAOD,GAGXE,KAAKkB,YAAYQ,MACvB,EACIC,cAAeC,GACT5B,KAAKC,MAAM4B,qBACbD,EAAEE,iBACFF,EAAEG,kBACF/B,KAAKkB,YAAYQ,OAEzB,G,aAjGI,MAAM,GAAE3B,GAAOC,KAAKC,MACpBD,KAAKM,WAAaN,KAAKM,WAAW0B,KAAKhC,MACvC,MAAMiC,EAAgBjC,KAAKkC,KAAKC,KAAKC,cACrCpC,KAAKkB,YAAc,IAAI,KAAWe,GAClCjC,KAAKkB,YAAYmB,GAAG,QAAQ,KAC1BvB,SAASC,KAAKC,UAAUC,OAAO,cAAc,GAC7CjB,KAAKqB,KAAK,SACVrB,KAAKkB,YAAYoB,WACjB,OAAK,gBAAiBvC,GACtBI,uBAAsB,IAAMW,SAASC,KAAKwB,YAAYN,IAAc,KAEtE,IAAAI,IAAG,aAAcrC,KAAMA,KAAKH,aAC5B,IAAAwC,IAAG,cAAerC,KAAMA,KAAKyB,cAC7B,QAAkB,SAAS1B,IACjC,C,aAEMK,OAAOoC,oBAAoB,WAAYxC,KAAKM,YAC5C,MAAM,YAAEkB,EAAW,YAAEhB,EAAW,GAAET,GAAOC,KAAKC,MAC1CO,IAAgBgB,GAElBpB,OAAOK,QAAQgC,QAEjB,QAAiB,SAAS1C,IAChC,C,iEAjLwC2C,O,iFAAAA,O,iJAAAA,M,kGAmLvB,CAEXC,cAAmC7B,SAAS8B,uBAAuB,gBAAgBC,OAAS,EAC5FzB,SAAS,EACT0B,OAAO,EACPC,eAAWC,EACXN,WAAOM,EACPC,kBAAkB,EAClBpB,oBAAoB,G,8+EA5LV,c,mHAD+BF,cAAcL,E,yBAcrCvB,G,oGAAiC0B,YAAY,EAAA1B,G,06BAxBzDmD,cAAa,iB,kZASgDC,YAAc,Q,cAL3EC,cAAa,kB,uDAERC,OAAS,G,sTANdH,cAAa,kB,EAWdR,M,gGAF8DS,YAAc,Q,gCAL3EC,cAAa,kB,kBAERC,OAAS,M,6DAkBFtD,I,2nBA4IxB,UAsCsB,QAAEqB,EAAO,cAAEuB,IACzB,OAAO,OACL,yBACCvB,GAAW,SACZuB,GAAiB,iBAE3B,C,2JACsB,QAAEvB,EAAO,MAAE0B,EAAK,cAAEH,EAAa,iBAAEM,EAAgB,UAAEF,IACjE,OAAO,OACL,yBACC3B,GAAW,SACZ0B,GAAS,cACTH,GAAiB,iBACjBM,GAAoB,sBACpBF,EAEV,C,sDC1NO,SAASO,IACd,MAAMC,EAAMzC,SAAS0C,cAAc,OAInC,OAHAD,EAAIE,aAAa,QAAS,gBAC1BF,EAAIE,aAAa,cAAe,QAChC3C,SAASC,KAAK2C,YAAYH,GACnBA,CACT,C,iBCNA,IAAII,GAAS,ECGN,SAAS9D,EAAY+D,EAAQC,GAClC,MAAMC,EAAS,IAAIF,EAAO,CACxBG,OAAQT,IACRO,KAAMG,OAAOC,OAAO,CAClBlE,KDJK4D,GCKJE,KAGL,OADAC,EAAO3C,OACA2C,CACT,C,gDCVO,SAASI,IACd,MAAM,GAAEnE,GAAOC,KAAKC,OACpB,OAAK,cAAeF,EACtB,C,gDCHA,SAASoE,EAAWC,GAClB,MAAM,GAAErE,GAAOC,KAAKC,MAChBF,IAAOqE,GAGXpE,KAAKsC,SACP,CAEO,SAAS+B,KACd,IAAAhC,IAAG,gBAAiBrC,KAAMmE,EAC5B,C,gDCVO,SAAShD,IACd,MAAM,GAAEpB,GAAOC,KAAKC,OACpB,OAAK,aAAcF,EACrB,C,8DCEO,MAAMuE,EAA2B,wJAKlCC,EAAc,GACpB,IAAIC,EASJ,SAASC,EAAYtC,EAAMuC,GAGzB1E,KAAK2E,MAAQ3E,KAAKmB,KAAKa,KAAKhC,MAC5BA,KAAK4E,MAAQ5E,KAAK0B,KAAKM,KAAKhC,MAC5BA,KAAK6E,eAAiB7E,KAAK6E,eAAe7C,KAAKhC,MAC/CA,KAAK8E,cAAgB9E,KAAK8E,cAAc9C,KAAKhC,MAG7CA,KAAKmC,KAAOA,EAGZnC,KAAK+E,WAAa,CAAC,EAGnB/E,KAAKgF,OAAON,EACd,CA+PA,SAASO,EAASC,GAChB,OAAOC,MAAMC,UAAUC,MAAMC,KAAKJ,EACpC,CAUA,SAASK,EAAIC,EAAUC,GACrB,OAAOR,GAASQ,GAAW3E,UAAU4E,iBAAiBF,GACxD,CA4BA,SAASG,EAAiBxD,GACxB,MAAMyD,EAAoBC,EAAqB1D,GAG/C,IAAK,MAAM2D,KAASF,EAClB,GAAIE,EAAMC,aAAa,aAErB,YADAD,EAAME,QAKNJ,EAAkB/C,QACpB+C,EAAkB,GAAGI,OAEzB,CAEA,SAASC,EAAY9D,EAAM+D,GACzB,IAAIC,EAAShE,EACb,KAAOgE,GAEL,GADAA,EAASA,EAAO/D,cACZ+D,IAAWD,EACb,OAAO,EAGX,OAAO,CACT,CAQA,SAASL,EAAsB1D,GAC7B,MAAMiE,EAA6Bb,EAAGjB,EAA0BnC,GAChE,IAAK,MAAMkE,KAAc9B,EACnB0B,EAAWI,EAAWC,cAAcC,KAAMpE,IAI5CiE,EAA2BI,QAAQH,EAAWX,iBAAiBpB,IAGnE,OAAO8B,EAA2BK,QAAOX,IAC/BA,EAAMY,WACb,KAAKC,KAAKb,EAAMC,aAAa,aAAe,MAC5CD,EAAMc,aAAa,WACnBd,EAAMe,aAAef,EAAMgB,cAAgBhB,EAAMiB,iBAAiBlE,SAEvE,CAmDA,SAASmE,EAAoBX,GACtB9B,EAAY0C,SAASZ,IACxB9B,EAAYiC,KAAKH,EAErB,CAEA,SAASa,EAAsBb,GAC7B,MAAMc,EAAQ5C,EAAY6C,QAAQf,IACnB,IAAXc,GACF5C,EAAY8C,OAAOF,EAAO,EAE9B,CAhZA1C,EAAWW,UAAUJ,OAAS,SAAUN,GA2BtC,OAzBA1E,KAAKsH,SAAWtH,KAAKsH,UA4QvB,SAAkBvD,GAChB,GAAIwD,SAASnC,UAAUoC,cAAczD,GACnC,OAAOkB,EAAQlB,GAGjB,GAAI0D,QAAQrC,UAAUoC,cAAczD,GAClC,MAAO,CAACA,GAGV,GAAsB,iBAAXA,EACT,OAAOwB,EAAGxB,EAEd,CAxRmC2D,CAAQhD,IAwX3C,SAAsBvC,GACpB,MACMwF,EADQ1C,EAAQ9C,EAAKyF,WAAWC,YACfpB,QAAO,SAAUtE,GACtC,OAAyB,IAAlBA,EAAK2F,QACd,IAIA,OAFAH,EAASN,OAAOM,EAASP,QAAQjF,GAAO,GAEjCwF,CACT,CAjYuDI,CAAY/H,KAAKmC,MAItEnC,KAAKmC,KAAKsB,aAAa,eAAe,GACtCzD,KAAKgI,OAAQ,EAIbhI,KAAKiI,SAAW1C,EAAG,2BAA6BvF,KAAKmC,KAAKpC,GAAK,MAC/DC,KAAKiI,SAASC,QAAQ,SAAUC,GAC9BA,EAAO9H,iBAAiB,QAASL,KAAK2E,MACxC,EAAE3C,KAAKhC,OAIPA,KAAKoI,SAAW7C,EAAG,0BAA2BvF,KAAKmC,MAChDkG,OAAO9C,EAAG,2BAA6BvF,KAAKmC,KAAKpC,GAAK,OACzDC,KAAKoI,SAASF,QAAQ,SAAUI,GAC9BA,EAAOjI,iBAAiB,QAASL,KAAK4E,MACxC,EAAE5C,KAAKhC,OAGPA,KAAKuI,MAAM,UAEJvI,IACT,EAUAyE,EAAWW,UAAUjE,KAAO,SAAUG,GAEpC,OAAItB,KAAKgI,QAIThI,KAAKgI,OAAQ,EACbhI,KAAKmC,KAAKqG,gBAAgB,eAK1BxI,KAAKsH,SAASY,SAAQ,SAAUnE,GAC9B,MAAM0E,EAAW1E,EAAOgC,aAAa,eAEjC0C,GACF1E,EAAON,aAAa,4BAA6BgF,GAGnD1E,EAAON,aAAa,cAAe,OACrC,IAKAe,EAAsB1D,SAAS4H,cAC/B/C,EAAgB3F,KAAKmC,MAKrBrB,SAASC,KAAKV,iBAAiB,QAASL,KAAK6E,gBAAgB,GAC7D/D,SAAST,iBAAiB,UAAWL,KAAK8E,eAG1C9E,KAAKuI,MAAM,OAAQjH,IAhCVtB,IAmCX,EAUAyE,EAAWW,UAAU1D,KAAO,SAAUJ,GAEpC,OAAKtB,KAAKgI,OAIVhI,KAAKgI,OAAQ,EACbhI,KAAKmC,KAAKsB,aAAa,cAAe,QAItCzD,KAAKsH,SAASY,SAAQ,SAAUnE,GAC9B,MAAM0E,EAAW1E,EAAOgC,aAAa,6BAEjC0C,GACF1E,EAAON,aAAa,cAAegF,GACnC1E,EAAOyE,gBAAgB,8BAEvBzE,EAAOyE,gBAAgB,cAE3B,IAIIhE,GAGFrE,uBAAsB,IAAMA,uBAAsB,IAAMqE,EAAoBwB,YAK9ElF,SAASC,KAAKyB,oBAAoB,QAASxC,KAAK6E,gBAAgB,GAChE/D,SAAS0B,oBAAoB,UAAWxC,KAAK8E,eAG7C9E,KAAKuI,MAAM,OAAQjH,GAEZtB,MAnCEA,IAoCX,EAQAyE,EAAWW,UAAU9C,QAAU,WAoB7B,OAlBAtC,KAAK0B,OAGL1B,KAAKiI,SAASC,QAAQ,SAAUC,GAC9BA,EAAO3F,oBAAoB,QAASxC,KAAK2E,MAC3C,EAAE3C,KAAKhC,OAGPA,KAAKoI,SAASF,QAAQ,SAAUI,GAC9BA,EAAO9F,oBAAoB,QAASxC,KAAK4E,MAC3C,EAAE5C,KAAKhC,OAGPA,KAAKuI,MAAM,WAGXvI,KAAK+E,WAAa,CAAC,EAEZ/E,IACT,EAQAyE,EAAWW,UAAU/C,GAAK,SAAUsG,EAAMC,GAOxC,YANqC,IAA1B5I,KAAK+E,WAAW4D,KACzB3I,KAAK+E,WAAW4D,GAAQ,IAG1B3I,KAAK+E,WAAW4D,GAAMnC,KAAKoC,GAEpB5I,IACT,EAQAyE,EAAWW,UAAUyD,IAAM,SAAUF,EAAMC,GACzC,MAAMzB,EAAQnH,KAAK+E,WAAW4D,GAAMvB,QAAQwB,GAM5C,OAJIzB,GAAS,GACXnH,KAAK+E,WAAW4D,GAAMtB,OAAOF,EAAO,GAG/BnH,IACT,EAUAyE,EAAWW,UAAUmD,MAAQ,SAAUI,EAAMrH,IACzBtB,KAAK+E,WAAW4D,IAAS,IAEjCT,QAAQ,SAAUY,GAC1BA,EAAS9I,KAAKmC,KAAMb,EACtB,EAAEU,KAAKhC,MACT,EASAyE,EAAWW,UAAUN,cAAgB,SAAUxD,GAGzCtB,KAAKgI,OAzPQ,KAyPC1G,EAAMyH,QACtBzH,EAAMQ,iBACN9B,KAAK0B,QAKH1B,KAAKgI,OAjQK,IAiQI1G,EAAMyH,OA6H1B,SAAqB5G,EAAMb,GACzB,MAAMsE,EAAoBC,EAAqB1D,GAC/C,IAAIuG,EAAgB5H,SAAS4H,cAC7B,IAAK,MAAMrC,KAAc9B,EACvB,GAAI8B,EAAWC,cAAcC,OAASmC,EAAe,CACnDA,EAAgBrC,EAAWqC,cAC3B,KACF,CAEF,MAAMM,EAAmBpD,EAAkBwB,QAAQsB,GAK/CpH,EAAM2H,UAAiC,IAArBD,GACpBpD,EAAkBA,EAAkB/C,OAAS,GAAGmD,QAChD1E,EAAMQ,kBAIIR,EAAM2H,UAAYD,IAAqBpD,EAAkB/C,OAAS,IAC5E+C,EAAkB,GAAGI,QACrB1E,EAAMQ,iBAEV,CApJIoH,CAAWlJ,KAAKmC,KAAMb,EAE1B,EASAmD,EAAWW,UAAUP,eAAiB,SAAUvD,GAG1CtB,KAAKgI,QAAUhI,KAAKmC,KAAKgH,SAAS7H,EAAMyC,SAC1C4B,EAAgB3F,KAAKmC,KAEzB,C","sources":["webpack://semaphore/./src/routes/_components/dialog/components/ModalDialog.html","webpack://semaphore/./src/routes/_components/dialog/helpers/createDialogElement.js","webpack://semaphore/./src/routes/_components/dialog/helpers/createDialogId.js","webpack://semaphore/./src/routes/_components/dialog/creators/showDialog.js","webpack://semaphore/./src/routes/_components/dialog/helpers/closeDialog.js","webpack://semaphore/./src/routes/_components/dialog/helpers/onCreateDialog.js","webpack://semaphore/./src/routes/_components/dialog/helpers/showDialog.js","webpack://semaphore/./src/routes/_thirdparty/a11y-dialog/a11y-dialog.js"],"sourcesContent":["<div class={backdropClass}\n     tabindex=\"-1\"\n     data-a11y-dialog-hide\n></div>\n<div class={contentsClass}\n     role=\"dialog\"\n     aria-label={label || ''}\n     ref:node\n>\n  <div class=\"modal-dialog-document\" role=\"document\" style=\"background: {background || '#000'};\">\n    <div class=\"modal-dialog-header\" on:click=\"onClickHeader(event)\">\n      {#if title}\n        <h1 class=\"modal-dialog-title\">{title}</h1>\n      {/if}\n      <div class=\"close-dialog-button-wrapper\">\n        <button class=\"close-dialog-button focus-fix\"\n                data-a11y-dialog-hide aria-label=\"Close dialog\">\n          <SvgIcon className=\"close-dialog-button-svg\" href=\"#fa-times\" />\n        </button>\n      </div>\n    </div>\n    <slot></slot>\n  </div>\n</div>\n<Shortcut scope=\"modal-{id}\" key=\"Backspace\" on:pressed=\"closeDialog(id)\"/>\n<style>\n  :global(.modal-dialog[aria-hidden='true']) {\n    display: none;\n  }\n  :global(.modal-dialog) {\n    position: fixed;\n    z-index: 10000;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .modal-dialog-backdrop {\n    position: fixed;\n    z-index: 10010;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n    background: rgba(51, 51, 51, 0.9);\n  }\n  .modal-dialog-backdrop.should-animate {\n    transition: opacity 0.2s linear;\n  }\n  .modal-dialog-contents {\n    z-index: 10020;\n    padding: 0;\n    border: 1px solid var(--main-border);\n    border-radius: 2px;\n    display: flex;\n    flex-direction: row;\n    max-height: calc(100% - 20px);\n    max-width: calc(100% - 20px);\n    flex: 0 1 580px;\n  }\n  .modal-dialog-contents.should-animate {\n    transition: opacity 0.2s linear;\n  }\n\n  .modal-dialog-document {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    max-width: 100%;\n    flex: 1;\n  }\n  .modal-dialog-header {\n    width: 100%;\n    background: var(--nav-bg);\n    display: flex;\n    align-items: center;\n  }\n  .modal-dialog-title {\n    color: var(--nav-text-color);\n    padding: 2px 0 2px 10px;\n    margin: 0;\n    font-size: 1.5em;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n  .close-dialog-button-wrapper {\n    flex: 1;\n    display: flex;\n    justify-content: flex-end;\n  }\n  .close-dialog-button {\n    padding: 0;\n    background: none;\n    border: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  :global(.close-dialog-button-svg) {\n    padding: 10px;\n    fill: var(--button-primary-text);\n    width: 24px;\n    height: 24px;\n    flex: 1;\n  }\n  .muted-style .modal-dialog-header {\n    background: var(--muted-modal-bg);\n  }\n  .muted-style .close-dialog-button:focus {\n    outline: 2px solid var(--muted-modal-focus);\n  }\n  .muted-style .close-dialog-button:hover {\n    background: var(--muted-modal-hover);\n  }\n  .muted-style.modal-dialog-contents {\n    border: none;\n  }\n  :global(body.modal-open) {\n    overflow-y: hidden;\n  }\n\n  @media(min-width: 480px) {\n    /* On desktop, some dialogs look bad if they expand to fit all the way. So we shrink\n       them to fit if shrinkWidthToFit is true.*/\n    .modal-dialog-contents.shrink-width-to-fit {\n      flex: none;\n    }\n  }\n\n  @media (max-width: 320px) {\n    .modal-dialog-title {\n      font-size: 1.3em;\n    }\n    :global(.close-dialog-button-svg) {\n      padding: 7px;\n      width: 18px;\n      height: 18px;\n    }\n  }\n\n  @media (max-width: 240px) {\n    .modal-dialog-contents {\n      min-width: calc(100% - 20px);\n    }\n  }\n</style>\n<script>\n  import Shortcut from '../../shortcut/Shortcut.html'\n  import SvgIcon from '../../SvgIcon.html'\n  import { A11yDialog } from '../../../_thirdparty/a11y-dialog/a11y-dialog.js'\n  import { classname } from '../../../_utils/classname.js'\n  import { on, emit } from '../../../_utils/eventBus.js'\n  import {\n    pushShortcutScope,\n    popShortcutScope\n  } from '../../../_utils/shortcuts.js'\n\n  export default {\n    oncreate () {\n      const { id } = this.get()\n      this.onPopState = this.onPopState.bind(this)\n      const dialogElement = this.refs.node.parentElement\n      this._a11yDialog = new A11yDialog(dialogElement)\n      this._a11yDialog.on('hide', () => {\n        document.body.classList.toggle('modal-open', false)\n        this.fire('close')\n        this._a11yDialog.destroy()\n        emit('destroyDialog', id)\n        requestAnimationFrame(() => document.body.removeChild(dialogElement))\n      })\n      on('showDialog', this, this.showDialog)\n      on('closeDialog', this, this.closeDialog)\n      pushShortcutScope(`modal-${id}`)\n    },\n    ondestroy () {\n      window.removeEventListener('popstate', this.onPopState)\n      const { statePopped, statePushed, id } = this.get()\n      if (statePushed && !statePopped) {\n        // If we weren't closed due to popstate, then pop state to ensure the correct history.\n        window.history.back()\n      }\n      popShortcutScope(`modal-${id}`)\n    },\n    components: { Shortcut, SvgIcon },\n    data: () => ({\n      // don't animate if we're showing a modal dialog on top of another modal dialog. it looks ugly\n      shouldAnimate: !process.browser || document.getElementsByClassName('modal-dialog').length < 2,\n      fadedIn: false,\n      muted: false,\n      className: undefined,\n      title: undefined,\n      shrinkWidthToFit: false,\n      clickHeaderToClose: false\n    }),\n    computed: {\n      backdropClass: ({ fadedIn, shouldAnimate }) => {\n        return classname(\n          'modal-dialog-backdrop',\n          !fadedIn && 'hidden',\n          shouldAnimate && 'should-animate'\n        )\n      },\n      contentsClass: ({ fadedIn, muted, shouldAnimate, shrinkWidthToFit, className }) => {\n        return classname(\n          'modal-dialog-contents',\n          !fadedIn && 'hidden',\n          muted && 'muted-style',\n          shouldAnimate && 'should-animate',\n          shrinkWidthToFit && 'shrink-width-to-fit',\n          className\n        )\n      }\n    },\n    methods: {\n      showDialog (otherId) {\n        const { id } = this.get()\n        if (otherId !== id) {\n          return\n        }\n        // This setTimeout is dumb, but it fixes issues with modals opening other modals\n        // due to the popstate/pushstate dance.\n        setTimeout(() => {\n          requestAnimationFrame(() => {\n            window.addEventListener('popstate', this.onPopState)\n            this.set({ statePushed: true })\n            window.history.pushState({ modal: id }, null, location.href)\n            document.body.classList.toggle('modal-open', true)\n            this._a11yDialog.show()\n            this.set({ fadedIn: true })\n            this.fire('show')\n            emit('dialogDidRender', id)\n          })\n        })\n      },\n      onPopState (event) {\n        const { id } = this.get()\n        if (!(event.state && event.state.modal === id)) {\n          // If the new state is not us, just assume that we need to be closed.\n          // This will only fail if modals are ever nested more than 2 levels deep.\n          this.set({ statePopped: true })\n          this.closeDialog(id)\n        }\n      },\n      closeDialog (otherId) {\n        const { id } = this.get()\n        if (id !== otherId) {\n          return\n        }\n        this._a11yDialog.hide()\n      },\n      onClickHeader (e) {\n        if (this.get().clickHeaderToClose) {\n          e.preventDefault()\n          e.stopPropagation()\n          this._a11yDialog.hide()\n        }\n      }\n    }\n  }\n</script>\n","export function createDialogElement () {\n  const div = document.createElement('div')\n  div.setAttribute('class', 'modal-dialog')\n  div.setAttribute('aria-hidden', 'true')\n  document.body.appendChild(div)\n  return div\n}\n","let count = -1\n\nexport function createDialogId () {\n  return ++count\n}\n","import { createDialogElement } from '../helpers/createDialogElement.js'\nimport { createDialogId } from '../helpers/createDialogId.js'\n\nexport function showDialog (Dialog, data) {\n  const dialog = new Dialog({\n    target: createDialogElement(),\n    data: Object.assign({\n      id: createDialogId()\n    }, data)\n  })\n  dialog.show()\n  return dialog\n}\n","import { emit } from '../../../_utils/eventBus.js'\n\nexport function close () {\n  const { id } = this.get()\n  emit('closeDialog', id)\n}\n","import { on } from '../../../_utils/eventBus.js'\n\nfunction onDestroy (thisId) {\n  const { id } = this.get()\n  if (id !== thisId) {\n    return\n  }\n  this.destroy()\n}\n\nexport function oncreate () {\n  on('destroyDialog', this, onDestroy)\n}\n","import { emit } from '../../../_utils/eventBus.js'\n\nexport function show () {\n  const { id } = this.get()\n  emit('showDialog', id)\n}\n","// Forked from a11y-dialog 4.0.1, adding a small change to element.focus() to work\n// around a Chrome bug with sticky positioning (https://github.com/nolanlawson/pinafore/issues/671)\n// Now it also works around shadow DOM and video/audio with controls.\n// (video/audio with controls is not 100% fixable because we can't focus the elements inside, but\n// you can at least tab to the video/audio and use other controls, like space bar and left/right)\n// Original: https://unpkg.com/a11y-dialog@4.0.1/a11y-dialog.js\n\nexport const FOCUSABLE_ELEMENTS_QUERY = 'a[href], area[href], input, select, textarea, ' +\n  'button, iframe, object, embed, [contenteditable], [tabindex], ' +\n  'video[controls], audio[controls], summary'\nconst TAB_KEY = 9\nconst ESCAPE_KEY = 27\nconst shadowRoots = []\nlet focusedBeforeDialog\n\n/**\n   * Define the constructor to instantiate a dialog\n   *\n   * @constructor\n   * @param {Element} node\n   * @param {(NodeList | Element | string)} targets\n   */\nfunction A11yDialog (node, targets) {\n  // Prebind the functions that will be bound in addEventListener and\n  // removeEventListener to avoid losing references\n  this._show = this.show.bind(this)\n  this._hide = this.hide.bind(this)\n  this._maintainFocus = this._maintainFocus.bind(this)\n  this._bindKeypress = this._bindKeypress.bind(this)\n\n  // Keep a reference of the node on the instance\n  this.node = node\n\n  // Keep an object of listener types mapped to callback functions\n  this._listeners = {}\n\n  // Initialise everything needed for the dialog to work properly\n  this.create(targets)\n}\n\n/**\n   * Set up everything necessary for the dialog to be functioning\n   *\n   * @param {(NodeList | Element | string)} targets\n   * @return {this}\n   */\nA11yDialog.prototype.create = function (targets) {\n  // Keep a collection of nodes to disable/enable when toggling the dialog\n  this._targets = this._targets || collect(targets) || getSiblings(this.node)\n\n  // Make sure the dialog element is disabled on load, and that the `shown`\n  // property is synced with its value\n  this.node.setAttribute('aria-hidden', true)\n  this.shown = false\n\n  // Keep a collection of dialog openers, each of which will be bound a click\n  // event listener to open the dialog\n  this._openers = $$('[data-a11y-dialog-show=\"' + this.node.id + '\"]')\n  this._openers.forEach(function (opener) {\n    opener.addEventListener('click', this._show)\n  }.bind(this))\n\n  // Keep a collection of dialog closers, each of which will be bound a click\n  // event listener to close the dialog\n  this._closers = $$('[data-a11y-dialog-hide]', this.node)\n    .concat($$('[data-a11y-dialog-hide=\"' + this.node.id + '\"]'))\n  this._closers.forEach(function (closer) {\n    closer.addEventListener('click', this._hide)\n  }.bind(this))\n\n  // Execute all callbacks registered for the `create` event\n  this._fire('create')\n\n  return this\n}\n\n/**\n   * Show the dialog element, disable all the targets (siblings), trap the\n   * current focus within it, listen for some specific key presses and fire all\n   * registered callbacks for `show` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\nA11yDialog.prototype.show = function (event) {\n  // If the dialog is already open, abort\n  if (this.shown) {\n    return this\n  }\n\n  this.shown = true\n  this.node.removeAttribute('aria-hidden')\n\n  // Iterate over the targets to disable them by setting their `aria-hidden`\n  // attribute to `true`; in case they already have this attribute, keep a\n  // reference of their original value to be able to restore it later\n  this._targets.forEach(function (target) {\n    const original = target.getAttribute('aria-hidden')\n\n    if (original) {\n      target.setAttribute('data-a11y-dialog-original', original)\n    }\n\n    target.setAttribute('aria-hidden', 'true')\n  })\n\n  // Keep a reference to the currently focused element to be able to restore\n  // it later, then set the focus to the first focusable child of the dialog\n  // element\n  focusedBeforeDialog = document.activeElement\n  setInitialFocus(this.node)\n\n  // Bind a focus event listener to the body element to make sure the focus\n  // stays trapped inside the dialog while open, and start listening for some\n  // specific key presses (TAB and ESC)\n  document.body.addEventListener('focus', this._maintainFocus, true)\n  document.addEventListener('keydown', this._bindKeypress)\n\n  // Execute all callbacks registered for the `show` event\n  this._fire('show', event)\n\n  return this\n}\n\n/**\n   * Hide the dialog element, enable all the targets (siblings), restore the\n   * focus to the previously active element, stop listening for some specific\n   * key presses and fire all registered callbacks for `hide` event\n   *\n   * @param {Event} event\n   * @return {this}\n   */\nA11yDialog.prototype.hide = function (event) {\n  // If the dialog is already closed, abort\n  if (!this.shown) {\n    return this\n  }\n\n  this.shown = false\n  this.node.setAttribute('aria-hidden', 'true')\n\n  // Iterate over the targets to enable them by remove their `aria-hidden`\n  // attribute or resetting them to their initial value\n  this._targets.forEach(function (target) {\n    const original = target.getAttribute('data-a11y-dialog-original')\n\n    if (original) {\n      target.setAttribute('aria-hidden', original)\n      target.removeAttribute('data-a11y-dialog-original')\n    } else {\n      target.removeAttribute('aria-hidden')\n    }\n  })\n\n  // If their was a focused element before the dialog was opened, restore the\n  // focus back to it\n  if (focusedBeforeDialog) {\n    // This double rAF is to work around a bug in Chrome when focusing sticky-positioned\n    // elements. See https://github.com/nolanlawson/pinafore/issues/671\n    requestAnimationFrame(() => requestAnimationFrame(() => focusedBeforeDialog.focus()))\n  }\n\n  // Remove the focus event listener to the body element and stop listening\n  // for specific key presses\n  document.body.removeEventListener('focus', this._maintainFocus, true)\n  document.removeEventListener('keydown', this._bindKeypress)\n\n  // Execute all callbacks registered for the `hide` event\n  this._fire('hide', event)\n\n  return this\n}\n\n/**\n   * Destroy the current instance (after making sure the dialog has been hidden)\n   * and remove all associated listeners from dialog openers and closers\n   *\n   * @return {this}\n   */\nA11yDialog.prototype.destroy = function () {\n  // Hide the dialog to avoid destroying an open instance\n  this.hide()\n\n  // Remove the click event listener from all dialog openers\n  this._openers.forEach(function (opener) {\n    opener.removeEventListener('click', this._show)\n  }.bind(this))\n\n  // Remove the click event listener from all dialog closers\n  this._closers.forEach(function (closer) {\n    closer.removeEventListener('click', this._hide)\n  }.bind(this))\n\n  // Execute all callbacks registered for the `destroy` event\n  this._fire('destroy')\n\n  // Keep an object of listener types mapped to callback functions\n  this._listeners = {}\n\n  return this\n}\n\n/**\n   * Register a new callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\nA11yDialog.prototype.on = function (type, handler) {\n  if (typeof this._listeners[type] === 'undefined') {\n    this._listeners[type] = []\n  }\n\n  this._listeners[type].push(handler)\n\n  return this\n}\n\n/**\n   * Unregister an existing callback for the given event type\n   *\n   * @param {string} type\n   * @param {Function} handler\n   */\nA11yDialog.prototype.off = function (type, handler) {\n  const index = this._listeners[type].indexOf(handler)\n\n  if (index > -1) {\n    this._listeners[type].splice(index, 1)\n  }\n\n  return this\n}\n\n/**\n   * Iterate over all registered handlers for given type and call them all with\n   * the dialog element as first argument, event as second argument (if any).\n   *\n   * @access private\n   * @param {string} type\n   * @param {Event} event\n   */\nA11yDialog.prototype._fire = function (type, event) {\n  const listeners = this._listeners[type] || []\n\n  listeners.forEach(function (listener) {\n    listener(this.node, event)\n  }.bind(this))\n}\n\n/**\n   * Private event handler used when listening to some specific key presses\n   * (namely ESCAPE and TAB)\n   *\n   * @access private\n   * @param {Event} event\n   */\nA11yDialog.prototype._bindKeypress = function (event) {\n  // If the dialog is shown and the ESCAPE key is being pressed, prevent any\n  // further effects from the ESCAPE key and hide the dialog\n  if (this.shown && event.which === ESCAPE_KEY) {\n    event.preventDefault()\n    this.hide()\n  }\n\n  // If the dialog is shown and the TAB key is being pressed, make sure the\n  // focus stays trapped within the dialog element\n  if (this.shown && event.which === TAB_KEY) {\n    trapTabKey(this.node, event)\n  }\n}\n\n/**\n   * Private event handler used when making sure the focus stays within the\n   * currently open dialog\n   *\n   * @access private\n   * @param {Event} event\n   */\nA11yDialog.prototype._maintainFocus = function (event) {\n  // If the dialog is shown and the focus is not within the dialog element,\n  // move it back to its first focusable child\n  if (this.shown && !this.node.contains(event.target)) {\n    setInitialFocus(this.node)\n  }\n}\n\n/**\n   * Convert a NodeList into an array\n   *\n   * @param {NodeList} collection\n   * @return {Array<Element>}\n   */\nfunction toArray (collection) {\n  return Array.prototype.slice.call(collection)\n}\n\n/**\n   * Query the DOM for nodes matching the given selector, scoped to context (or\n   * the whole document)\n   *\n   * @param {String} selector\n   * @param {Element} [context = document]\n   * @return {Array<Element>}\n   */\nfunction $$ (selector, context) {\n  return toArray((context || document).querySelectorAll(selector))\n}\n\n/**\n   * Return an array of Element based on given argument (NodeList, Element or\n   * string representing a selector)\n   *\n   * @param {(NodeList | Element | string)} target\n   * @return {Array<Element>}\n   */\nfunction collect (target) {\n  if (NodeList.prototype.isPrototypeOf(target)) { // eslint-disable-line no-prototype-builtins\n    return toArray(target)\n  }\n\n  if (Element.prototype.isPrototypeOf(target)) { // eslint-disable-line no-prototype-builtins\n    return [target]\n  }\n\n  if (typeof target === 'string') {\n    return $$(target)\n  }\n}\n\n/**\n   * Set the focus to the first focusable child of the given element\n   *\n   * @param {Element} node\n   */\nfunction setInitialFocus (node) {\n  const focusableChildren = getFocusableChildren(node)\n\n  // If there's an element with an autofocus attribute, focus that.\n  for (const child of focusableChildren) {\n    if (child.getAttribute('autofocus')) {\n      child.focus()\n      return\n    }\n  }\n  // Otherwise, focus the first focusable element.\n  if (focusableChildren.length) {\n    focusableChildren[0].focus()\n  }\n}\n\nfunction isAncestor (node, ancestor) {\n  let parent = node\n  while (parent) {\n    parent = parent.parentElement\n    if (parent === ancestor) {\n      return true\n    }\n  }\n  return false\n}\n\n/**\n   * Get the focusable children of the given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\nfunction getFocusableChildren (node) {\n  const candidateFocusableChildren = $$(FOCUSABLE_ELEMENTS_QUERY, node)\n  for (const shadowRoot of shadowRoots) {\n    if (isAncestor(shadowRoot.getRootNode().host, node)) {\n      // TODO: technically we should figure out the host's position in the DOM\n      // and insert the children there, but this works for the emoji picker dialog well\n      // enough, and that's our only shadow root, so it's fine for now.\n      candidateFocusableChildren.push(...shadowRoot.querySelectorAll(FOCUSABLE_ELEMENTS_QUERY))\n    }\n  }\n  return candidateFocusableChildren.filter(child => {\n    return !child.disabled &&\n    !/^-/.test(child.getAttribute('tabindex') || '') &&\n    !child.hasAttribute('inert') && // see https://github.com/GoogleChrome/inert-polyfill\n    (child.offsetWidth || child.offsetHeight || child.getClientRects().length)\n  })\n}\n\n/**\n   * Trap the focus inside the given element\n   *\n   * @param {Element} node\n   * @param {Event} event\n   */\nfunction trapTabKey (node, event) {\n  const focusableChildren = getFocusableChildren(node)\n  let activeElement = document.activeElement\n  for (const shadowRoot of shadowRoots) {\n    if (shadowRoot.getRootNode().host === activeElement) {\n      activeElement = shadowRoot.activeElement\n      break\n    }\n  }\n  const focusedItemIndex = focusableChildren.indexOf(activeElement)\n\n  // If the SHIFT key is being pressed while tabbing (moving backwards) and\n  // the currently focused item is the first one, move the focus to the last\n  // focusable item from the dialog element\n  if (event.shiftKey && focusedItemIndex === 0) {\n    focusableChildren[focusableChildren.length - 1].focus()\n    event.preventDefault()\n    // If the SHIFT key is not being pressed (moving forwards) and the currently\n    // focused item is the last one, move the focus to the first focusable item\n    // from the dialog element\n  } else if (!event.shiftKey && focusedItemIndex === focusableChildren.length - 1) {\n    focusableChildren[0].focus()\n    event.preventDefault()\n  }\n}\n\n/**\n   * Retrieve siblings from given element\n   *\n   * @param {Element} node\n   * @return {Array<Element>}\n   */\nfunction getSiblings (node) {\n  const nodes = toArray(node.parentNode.childNodes)\n  const siblings = nodes.filter(function (node) {\n    return node.nodeType === 1\n  })\n\n  siblings.splice(siblings.indexOf(node), 1)\n\n  return siblings\n}\n\nfunction registerShadowRoot (shadowRoot) {\n  if (!shadowRoots.includes(shadowRoot)) {\n    shadowRoots.push(shadowRoot)\n  }\n}\n\nfunction unregisterShadowRoot (shadowRoot) {\n  const index = shadowRoots.indexOf(shadowRoot)\n  if (index !== -1) {\n    shadowRoots.splice(index, 1)\n  }\n}\n\nexport { A11yDialog, registerShadowRoot, unregisterShadowRoot }\n"],"names":["showDialog","otherId","id","this","get","setTimeout","requestAnimationFrame","window","addEventListener","onPopState","set","statePushed","history","pushState","modal","location","href","document","body","classList","toggle","_a11yDialog","show","fadedIn","fire","event","state","statePopped","closeDialog","hide","onClickHeader","e","clickHeaderToClose","preventDefault","stopPropagation","bind","dialogElement","refs","node","parentElement","on","destroy","removeChild","removeEventListener","back","title","shouldAnimate","getElementsByClassName","length","muted","className","undefined","shrinkWidthToFit","backdropClass","background","contentsClass","label","createDialogElement","div","createElement","setAttribute","appendChild","count","Dialog","data","dialog","target","Object","assign","close","onDestroy","thisId","oncreate","FOCUSABLE_ELEMENTS_QUERY","shadowRoots","focusedBeforeDialog","A11yDialog","targets","_show","_hide","_maintainFocus","_bindKeypress","_listeners","create","toArray","collection","Array","prototype","slice","call","$$","selector","context","querySelectorAll","setInitialFocus","focusableChildren","getFocusableChildren","child","getAttribute","focus","isAncestor","ancestor","parent","candidateFocusableChildren","shadowRoot","getRootNode","host","push","filter","disabled","test","hasAttribute","offsetWidth","offsetHeight","getClientRects","registerShadowRoot","includes","unregisterShadowRoot","index","indexOf","splice","_targets","NodeList","isPrototypeOf","Element","collect","siblings","parentNode","childNodes","nodeType","getSiblings","shown","_openers","forEach","opener","_closers","concat","closer","_fire","removeAttribute","original","activeElement","type","handler","off","listener","which","focusedItemIndex","shiftKey","trapTabKey","contains"],"sourceRoot":""}