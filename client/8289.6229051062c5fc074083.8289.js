"use strict";(this.webpackChunksemaphore=this.webpackChunksemaphore||[]).push([[8289],{8289:(t,e,n)=>{function o(t){if("string"!=typeof t||!t)throw new Error("expected a non-empty string, got: "+t)}function r(t){if("number"!=typeof t)throw new Error("expected a number, got: "+t)}n.d(e,{Z:()=>Z});const s="emoji",i="keyvalue",a="favorites",c="tokens",u="count",f="group-order",d="eTag",h="url",l="skinTone",w="readonly",m="readwrite",y="skinUnicodes";function p(t){return function(t,e){const n=new Set,o=[];for(const r of t){const t=e(r);n.has(t)||(n.add(t),o.push(r))}return o}(t,(t=>t.unicode))}const g={},_={},b={};function k(t,e,n){n.onerror=()=>e(n.error),n.onblocked=()=>e(new Error("IDB blocked")),n.onsuccess=()=>t(n.result)}async function j(t){const e=await new Promise(((e,n)=>{const o=indexedDB.open(t,1);g[t]=o,o.onupgradeneeded=t=>{t.oldVersion<1&&function(t){function e(e,n,o){const r=n?t.createObjectStore(e,{keyPath:n}):t.createObjectStore(e);if(o)for(const[t,[s,i]]of Object.entries(o))r.createIndex(t,s,{multiEntry:i});return r}e(i),e(s,"unicode",{[c]:["tokens",!0],[f]:[["group","order"]],[y]:["skinUnicodes",!0]}),e(a,void 0,{[u]:[""]})}(o.result)},k(e,n,o)}));return e.onclose=()=>S(t),e}function v(t,e,n,o){return new Promise(((r,s)=>{const i=t.transaction(e,n,{durability:"relaxed"}),a="string"==typeof e?i.objectStore(e):e.map((t=>i.objectStore(t)));let c;o(a,i,(t=>{c=t})),i.oncomplete=()=>r(c),i.onerror=()=>s(i.error)}))}function S(t){const e=g[t],n=e&&e.result;if(n){n.close();const e=b[t];if(e)for(const t of e)t()}delete g[t],delete _[t],delete b[t]}const C=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function E(t){return t.split(/[\s_]+/).map((t=>!t.match(/\w/)||C.has(t)?t.toLowerCase():t.replace(/[)(:,]/g,"").replace(/’/g,"'").toLowerCase())).filter(Boolean)}function B(t){return t.filter(Boolean).map((t=>t.toLowerCase())).filter((t=>t.length>=2))}function A(t,e,n,o){t[e](n).onsuccess=t=>o&&o(t.target.result)}function D(t,e,n){A(t,"get",e,n)}function L(t,e,n){A(t,"getAll",e,n)}function x(t){t.commit&&t.commit()}function U(t,e){const n=function(t,e){let n=t[0];for(let o=1;o<t.length;o++){const r=t[o];e(n)>e(r)&&(n=r)}return n}(t,(t=>t.length)),o=[];for(const r of n)t.some((t=>-1===t.findIndex((t=>e(t)===e(r)))))||o.push(r);return o}async function T(t,e,n,o){try{const r=function(t){return t.map((({annotation:t,emoticon:e,group:n,order:o,shortcodes:r,skins:s,tags:i,emoji:a,version:c})=>{const u=[...new Set(B([...(r||[]).map(E).flat(),...i.map(E).flat(),...E(t),e]))].sort(),f={annotation:t,group:n,order:o,tags:i,tokens:u,unicode:a,version:c};if(e&&(f.emoticon=e),r&&(f.shortcodes=r),s){f.skinTones=[],f.skinUnicodes=[],f.skinVersions=[];for(const{tone:t,emoji:e,version:n}of s)f.skinTones.push(t),f.skinUnicodes.push(e),f.skinVersions.push(n)}return f}))}(e);await v(t,[s,i],m,(([t,e],s)=>{let i,a,c=0;function u(){2==++c&&function(){if(i===o&&a===n)return;t.clear();for(const e of r)t.put(e);e.put(o,d),e.put(n,h),x(s)}()}D(e,d,(t=>{i=t,u()})),D(e,h,(t=>{a=t,u()}))}))}finally{}}async function N(t,e){const n=B(E(e));return n.length?v(t,s,w,((t,e,o)=>{const r=[],s=()=>{const t=U(r,(t=>t.unicode));o(t.sort(((t,e)=>t.order<e.order?-1:1)))};for(let i=0;i<n.length;i++){const e=n[i],o=i===n.length-1?IDBKeyRange.bound(e,e+"￿",!1,!0):IDBKeyRange.only(e);L(t.index(c),o,(t=>{r.push(t),r.length===n.length&&s()}))}})):[]}async function P(t,e){const n=await N(t,e);if(!n.length){const n=t=>(t.shortcodes||[]).includes(e.toLowerCase());return await async function(t,e){return v(t,s,w,((t,n,o)=>{let r;const s=()=>{t.getAll(r&&IDBKeyRange.lowerBound(r,!0),50).onsuccess=t=>{const n=t.target.result;for(const s of n)if(r=s.unicode,e(s))return o(s);if(n.length<50)return o();s()}};s()}))}(t,n)||null}return n.filter((t=>{const n=(t.shortcodes||[]).map((t=>t.toLowerCase()));return n.includes(e.toLowerCase())}))[0]||null}function O(t,e,n){return v(t,e,w,((t,e,o)=>D(t,n,o)))}const I=["name","url"];function M(t){!function(t){const e=t&&Array.isArray(t),n=e&&t.length&&(!t[0]||I.some((e=>!(e in t[0]))));if(!e||n)throw new Error("Custom emojis are in the wrong format")}(t);const e=(t,e)=>t.name.toLowerCase()<e.name.toLowerCase()?-1:1,n=t.sort(e),o=function(t,e){const n=new Map;for(const o of t){const t=e(o);for(const e of t){let t=n;for(let n=0;n<e.length;n++){const o=e.charAt(n);let r=t.get(o);r||(r=new Map,t.set(o,r)),t=r}let r=t.get("");r||(r=[],t.set("",r)),r.push(o)}}return(t,e)=>{let o=n;for(let n=0;n<t.length;n++){const e=t.charAt(n),r=o.get(e);if(!r)return[];o=r}if(e)return o.get("")||[];const r=[],s=[o];for(;s.length;){const t=[...s.shift().entries()].sort(((t,e)=>t[0]<e[0]?-1:1));for(const[e,n]of t)""===e?r.push(...n):s.push(n)}return r}}(t,(t=>[...new Set((t.shortcodes||[]).map((t=>E(t))).flat())])),r=t=>o(t,!0),s=t=>o(t,!1),i=new Map,a=new Map;for(const c of t){a.set(c.name.toLowerCase(),c);for(const t of c.shortcodes||[])i.set(t.toLowerCase(),c)}return{all:n,search:t=>{const n=E(t);return U(n.map(((t,e)=>(e<n.length-1?r:s)(t))),(t=>t.name)).sort(e)},byShortcode:t=>i.get(t.toLowerCase()),byName:t=>a.get(t.toLowerCase())}}function K(t){if(!t)return t;if(delete t.tokens,t.skinTones){const e=t.skinTones.length;t.skins=Array(e);for(let n=0;n<e;n++)t.skins[n]={tone:t.skinTones[n],unicode:t.skinUnicodes[n],version:t.skinVersions[n]};delete t.skinTones,delete t.skinUnicodes,delete t.skinVersions}return t}function V(t){t||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const X=["annotation","emoji","group","order","tags","version"];function z(t,e){if(2!==Math.floor(t.status/100))throw new Error("Failed to fetch: "+e+":  "+t.status)}async function R(t){const e=await fetch(t);z(e,t);const n=e.headers.get("etag");V(n);const o=await e.json();return function(t){if(!t||!Array.isArray(t)||!t[0]||"object"!=typeof t[0]||X.some((e=>!(e in t[0]))))throw new Error("Emoji data is in the wrong format")}(o),[n,o]}async function F(t){const e=function(t){for(var e=t.length,n=new ArrayBuffer(e),o=new Uint8Array(n),r=-1;++r<e;)o[r]=t.charCodeAt(r);return n}(JSON.stringify(t)),n=function(t){for(var e="",n=new Uint8Array(t),o=n.byteLength,r=-1;++r<o;)e+=String.fromCharCode(n[r]);return e}(await crypto.subtle.digest("SHA-1",e));return btoa(n)}async function H(t,e){let n,o=await async function(t){const e=await fetch(t,{method:"HEAD"});z(e,t);const n=e.headers.get("etag");return V(n),n}(e);if(!o){const t=await R(e);o=t[0],n=t[1],o||(o=await F(n))}if(await async function(t,e,n){const[o,r]=await Promise.all([d,h].map((e=>O(t,i,e))));return o===n&&r===e}(t,e,o));else{if(!n){n=(await R(e))[1]}await T(t,n,e,o)}}class Z{constructor({dataSource:t="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",locale:e="en",customEmoji:n=[]}={}){this.dataSource=t,this.locale=e,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=M(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const t=this._db=await(e=this._dbName,_[e]||(_[e]=j(e)),_[e]);var e;!function(t,e){let n=b[t];n||(n=b[t]=[]),n.push(e)}(this._dbName,this._clear);const n=this.dataSource,o=await async function(t){return!(await O(t,i,h))}(t);o?await async function(t,e){let[n,o]=await R(e);n||(n=await F(o)),await T(t,o,e,n)}(t,n):this._lazyUpdate=H(t,n)}async ready(){const t=async()=>(this._ready||(this._ready=this._init()),this._ready);await t(),this._db||await t()}async getEmojiByGroup(t){return r(t),await this.ready(),p(await async function(t,e){return v(t,s,w,((t,n,o)=>{const r=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);L(t.index(f),r,o)}))}(this._db,t)).map(K)}async getEmojiBySearchQuery(t){o(t),await this.ready();return[...this._custom.search(t),...p(await N(this._db,t)).map(K)]}async getEmojiByShortcode(t){o(t),await this.ready();const e=this._custom.byShortcode(t);return e||K(await P(this._db,t))}async getEmojiByUnicodeOrName(t){o(t),await this.ready();const e=this._custom.byName(t);return e||K(await async function(t,e){return v(t,s,w,((t,n,o)=>D(t,e,(n=>{if(n)return o(n);D(t.index(y),e,(t=>o(t||null)))}))))}(this._db,t))}async getPreferredSkinTone(){return await this.ready(),await O(this._db,i,l)||0}async setPreferredSkinTone(t){return r(t),await this.ready(),e=this._db,n=l,o=t,v(e,i,m,((t,e)=>{t.put(o,n),x(e)}));var e,n,o}async incrementFavoriteEmojiCount(t){return o(t),await this.ready(),e=this._db,n=t,v(e,a,m,((t,e)=>D(t,n,(o=>{t.put((o||0)+1,n),x(e)}))));var e,n}async getTopFavoriteEmoji(t){return r(t),await this.ready(),(await function(t,e,n){return 0===n?[]:v(t,[a,s],w,(([t,o],r,s)=>{const i=[];t.index(u).openCursor(void 0,"prev").onsuccess=t=>{const r=t.target.result;if(!r)return s(i);function a(t){if(i.push(t),i.length===n)return s(i);r.continue()}const c=r.primaryKey,u=e.byName(c);if(u)return a(u);D(o,c,(t=>{if(t)return a(t);r.continue()}))}}))}(this._db,this._custom,t)).map(K)}set customEmoji(t){this._custom=M(t)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch(t){}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await S(this._dbName)}async delete(){var t;await this._shutdown(),await(t=this._dbName,new Promise(((e,n)=>{S(t),k(e,n,indexedDB.deleteDatabase(t))})))}}}}]);
//# sourceMappingURL=8289.6229051062c5fc074083.8289.js.map