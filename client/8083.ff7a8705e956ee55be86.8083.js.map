{"version":3,"file":"8083.ff7a8705e956ee55be86.8083.js","mappings":"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","sources":["webpack://semaphore/./src/routes/_components/settings/instance/ThemeSettings.html","webpack://semaphore/./src/routes/_api/user.js","webpack://semaphore/./src/routes/_utils/asyncModules/importDatabase.js","webpack://semaphore/./src/routes/_database/asyncDatabase.js","webpack://semaphore/./src/routes/_static/themes.js","webpack://semaphore/./src/routes/_utils/sync.js"],"sourcesContent":["<form class=\"generic-instance-settings\" aria-label=\"Choose a theme\">\n  <div class=\"theme-groups\">\n    {#each themeGroups as themeGroup}\n    <div class=\"theme-group\">\n      <h3>\n        {themeGroup.dark ? \"Dark background\" : \"Light background\" }\n      </h3>\n      {#each themeGroup.themes as theme}\n      <div class=\"theme-picker\">\n        <input type=\"radio\" id=\"choice-theme-{theme.name}\"\n               value={theme.name} checked=\"$currentTheme === theme.name\"\n               bind:group=\"selectedTheme\" on:change=\"onThemeChange()\">\n        <label class=\"theme-picker-label\" for=\"choice-theme-{theme.name}\">\n          <div class=\"theme-preview theme-preview-{themeGroup.dark ? 'dark' : 'light'}\"\n               style=\"background-color: {theme.color};\" >\n          </div>\n          <span class=\"theme-picker-label-span\">\n            {createThemeLabel(theme)}\n          </span>\n        </label>\n      </div>\n      {/each}\n    </div>\n    {/each}\n  </div>\n</form>\n<GenericInstanceSettingsStyle/>\n<style>\n  .theme-groups {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n  }\n  .theme-group {\n    display: flex;\n    flex-direction: column;\n    align-items: flex-start;\n    flex: 1;\n  }\n  .theme-picker {\n    display: flex;\n    align-items: center;\n  }\n  .theme-picker-label {\n    display: flex;\n    align-items: center;\n  }\n  .theme-picker-label-span {\n    margin: 2px 10px 0;\n  }\n  .theme-preview {\n    width: 21px;\n    height: 21px;\n    box-sizing: border-box;\n    border-radius: 2px;\n    margin: 0 2px 0 10px;\n  }\n  .theme-preview-dark {\n    border: 2px solid #000;\n  }\n  .theme-preview-light {\n    border: 2px solid #dadada;\n  }\n\n  h3 {\n    font-size: 1.4em;\n  }\n\n  @media (max-width: 479px) {\n    .theme-groups {\n      grid-template-columns: 1fr;\n    }\n\n    h3 {\n      margin-top: 0.5em;\n    }\n  }\n\n  @media (max-width: 240px) {\n    .theme-groups {\n      grid-row-gap: 25px; /* TODO: \"Dark background\" text overlaps with previous div on KaiOS for some reason */\n    }\n  }\n</style>\n<script>\n  import GenericInstanceSettingsStyle from './GenericInstanceSettingsStyle.html'\n  import { changeTheme } from '../../../_actions/instances.js'\n  import { store } from '../../../_store/store.js'\n  import { themes } from '../../../_static/themes.js'\n  import { DEFAULT_THEME } from '../../../_utils/themeEngine.js'\n  import { formatIntl } from '../../../_utils/formatIntl.js'\n\n  export default {\n    async oncreate () {\n      const { instanceName } = this.get()\n      const { instanceThemes } = this.store.get()\n      this.set({\n        selectedTheme: instanceThemes[instanceName] || DEFAULT_THEME\n      })\n    },\n    store: () => store,\n    data: () => ({\n      themes,\n      DEFAULT_THEME,\n      selectedTheme: DEFAULT_THEME\n    }),\n    computed: {\n      themeGroups: ({ themes }) => ([\n        {\n          dark: false,\n          themes: themes.filter(_ => !_.dark)\n        },\n        {\n          dark: true,\n          themes: themes.filter(_ => _.dark)\n        }\n      ])\n    },\n    helpers: {\n      createThemeLabel (theme) {\n        return formatIntl([[\"label\"],\" \",[\"default\",\"select\",{\"true\":[\"(default)\"],\"other\":[]}]], {\n          label: theme.label,\n          default: theme.name === DEFAULT_THEME\n        })\n      }\n    },\n    methods: {\n      onThemeChange () {\n        const { selectedTheme, instanceName } = this.get()\n        changeTheme(instanceName, selectedTheme)\n      }\n    },\n    components: {\n      GenericInstanceSettingsStyle\n    }\n  }\n</script>\n","import { get, DEFAULT_TIMEOUT } from '../_utils/ajax.js'\nimport { auth, basename } from './utils.js'\n\nexport function getVerifyCredentials (instanceName, accessToken) {\n  const url = `${basename(instanceName)}/api/v1/accounts/verify_credentials`\n  return get(url, auth(accessToken), { timeout: DEFAULT_TIMEOUT })\n}\n\nexport function getAccount (instanceName, accessToken, accountId) {\n  const url = `${basename(instanceName)}/api/v1/accounts/${accountId}`\n  return get(url, auth(accessToken), { timeout: DEFAULT_TIMEOUT })\n}\n","export const importDatabase = () => import(\n  '../../_database/databaseApis.js'\n)\n","// All database functions are asynchronous, so we can just proxy here and\n// put an async import of the database, to avoid including it in the main bundle\n// (which doesn't need to run when the user isn't logged in).\n\nimport { importDatabase } from '../_utils/asyncModules/importDatabase.js'\n\nconst handler = {\n  get: function (obj, prop) {\n    return async function (...args) {\n      if (!obj[prop]) {\n        const database = await importDatabase()\n        obj[prop] = database[prop]\n      }\n      return obj[prop].apply(null, args)\n    }\n  }\n}\n\nexport const asyncDatabase = new Proxy({}, handler)\n","const themes = [\n  {\n    name: 'default',\n    label: \"Light\",\n    dark: false,\n    color: '#6248CA'\n  },\n  {\n    name: 'scarlet',\n    label: \"Scarlet\",\n    dark: false,\n    color: '#e04e41'\n  },\n  {\n    name: 'seafoam',\n    label: \"Seafoam\",\n    dark: false,\n    color: '#177380'\n  },\n  {\n    name: 'hotpants',\n    label: \"Hotpants\",\n    dark: false,\n    color: 'hotpink'\n  },\n  {\n    name: 'oaken',\n    label: \"Oaken\",\n    dark: false,\n    color: 'saddlebrown'\n  },\n  {\n    name: 'majesty',\n    label: \"Majesty\",\n    dark: false,\n    color: 'blueviolet'\n  },\n  {\n    name: 'gecko',\n    label: \"Gecko\",\n    dark: false,\n    color: '#4ab92f'\n  },\n  {\n    name: 'grayscale',\n    label: \"Grayscale\",\n    dark: false,\n    color: '#999999'\n  },\n  {\n    name: 'ozark',\n    label: \"Dark\",\n    dark: true,\n    color: '#6248CA'\n  },\n  {\n    name: 'cobalt',\n    label: \"Cobalt\",\n    dark: true,\n    color: '#08439b'\n  },\n  {\n    name: 'sorcery',\n    label: \"Sorcery\",\n    dark: true,\n    color: '#ae91e8'\n  },\n  {\n    name: 'punk',\n    label: \"Punk\",\n    dark: true,\n    color: '#e04e41'\n  },\n  {\n    name: 'riot',\n    label: \"Riot\",\n    dark: true,\n    color: 'hotpink'\n  },\n  {\n    name: 'hacker',\n    label: \"Hacker\",\n    dark: true,\n    color: '#4ab92f'\n  },\n  {\n    name: 'mastodon',\n    label: \"Mastodon\",\n    dark: true,\n    color: '#282C37'\n  },\n  {\n    name: 'pitchblack',\n    label: \"Pitch Black\",\n    dark: true,\n    color: '#000'\n  },\n  {\n    name: 'dark-grayscale',\n    label: \"Dark Grayscale\",\n    dark: true,\n    color: '#666'\n  }\n]\n\nexport { themes }\n","// Hit both the cache and the network, setting state for the cached version first,\n// then the network version (as it's assumed to be fresher). Also update the db afterwards.\nexport async function cacheFirstUpdateAfter (networkFetcher, dbFetcher, dbUpdater, stateSetter) {\n  const networkPromise = networkFetcher() // kick off network request immediately\n  let dbResponse\n  try {\n    dbResponse = await dbFetcher()\n  } catch (err) {\n    console.error('ignored DB error', err)\n  } finally {\n    if (dbResponse) {\n      stateSetter(dbResponse)\n    }\n    const fetchAndUpdatePromise = networkPromise.then(networkResponse => {\n      /* no await */ dbUpdater(networkResponse)\n      stateSetter(networkResponse)\n    })\n    if (!dbResponse) { // no cached result available, await the network\n      await fetchAndUpdatePromise\n    }\n  }\n}\n\n// Try the cache first. If we get a hit, set the state and do nothing. If we don't get a cache hit,\n// then go to the network, update the cache, and set the state.\nexport async function cacheFirstUpdateOnlyIfNotInCache (networkFetcher, dbFetcher, dbUpdater, stateSetter) {\n  let dbResponse\n  try {\n    dbResponse = await dbFetcher()\n  } catch (err) {\n    console.error('ignored DB error', err)\n  }\n  if (dbResponse) {\n    stateSetter(dbResponse)\n  } else {\n    const networkResponse = await networkFetcher()\n    /* no await */ dbUpdater(networkResponse)\n    stateSetter(networkResponse)\n  }\n}\n"],"names":["theme","label","default","name","onThemeChange","selectedTheme","instanceName","this","get","instanceThemes","store","set","createThemeLabel","themeGroup","dark","color","themes","DEFAULT_THEME","themeGroups","filter","_","getVerifyCredentials","accessToken","url","timeout","getAccount","accountId","asyncDatabase","Proxy","obj","prop","async","args","database","apply","cacheFirstUpdateAfter","networkFetcher","dbFetcher","dbUpdater","stateSetter","networkPromise","dbResponse","err","console","error","fetchAndUpdatePromise","then","networkResponse","cacheFirstUpdateOnlyIfNotInCache"],"sourceRoot":""}