"use strict";(this.webpackChunksemaphore=this.webpackChunksemaphore||[]).push([[2307],{2307:(e,n,t)=>{t.d(n,{Lr:()=>I,jh:()=>f,rd:()=>g,Q:()=>m,Ac:()=>d});var s=t(2625),a=t(5277),c=t(1169),i=t(7031),o=t(3973),r=t(1370),h=t(281),l=t(1162);var u=t(6633);function I(e,n){const{instanceThemes:t}=a.h.get();t[e]=n,a.h.set({instanceThemes:t}),a.h.save();const{currentInstance:s}=a.h.get();if(e===s){const{enableGrayscale:e}=a.h.get();(0,c.Xi)(n,e)}}function g(e){const{instanceThemes:n}=a.h.get();a.h.set({currentInstance:e,searchResults:null,queryInSearch:""}),a.h.save();const{enableGrayscale:t}=a.h.get();(0,c.Xi)(n[e],t)}async function f(e,n){n=n||(0,u.A)(["Logged out of ",["instance"]],{instance:e});const{composeData:s,currentInstance:r,customEmoji:h,instanceInfos:I,instanceLists:g,instanceThemes:f,loggedInInstances:d,loggedInInstancesInOrder:m,verifyCredentials:y}=a.h.get();m.splice(m.indexOf(e),1);const v=e===r?m[0]:r,p=[s,h,I,g,f,d,y];for(const t of p)delete t[e];a.h.set({composeData:s,currentInstance:v,customEmoji:h,instanceInfos:I,instanceLists:g,instanceThemes:f,loggedInInstances:d,loggedInInstancesInOrder:m,queryInSearch:"",searchResults:null,timelineInitialized:!1,timelinePreinitialized:!1,verifyCredentials:y}),a.h.clearTimelineDataForInstance(e),a.h.clearAutosuggestDataForInstance(e),a.h.save();const{virtualListStore:k}=await Promise.all([t.e(4285),t.e(9225),t.e(4292)]).then(t.bind(t,9225));k.clearRealmByPrefix(r+"/"),i.A.say(n);const{enableGrayscale:w}=a.h.get();(0,c.Xi)(f[v],w),l.F.clearDatabaseForInstance(e),(0,o.E9)("/settings/instances")}async function d(e){const{loggedInInstances:n}=a.h.get(),t=n[e].access_token;await(0,r.u)((()=>(0,s.Q)(e,t).catch(function(e){return async n=>{throw n.message.startsWith("401:")&&await f(e,(0,u.A)(["The access token was revoked, logged out of ",["instance"]],{instance:e})),n}}(e))),(()=>l.F.getInstanceVerifyCredentials(e)),(n=>l.F.setInstanceVerifyCredentials(e,n)),(n=>function(e,n){const{verifyCredentials:t}=a.h.get();t[e]=n,a.h.set({verifyCredentials:t})}(e,n)))}async function m(e){await(0,r.u)((()=>{const{loggedInInstances:n}=a.h.get(),t=n[e]&&n[e].access_token;return(0,h.s)(e,t)}),(()=>l.F.getInstanceInfo(e)),(n=>l.F.setInstanceInfo(e,n)),(n=>{const{instanceInfos:t}=a.h.get();t[e]=n,a.h.set({instanceInfos:t})}))}},281:(e,n,t)=>{t.d(n,{s:()=>c});var s=t(385),a=t(4886);function c(e,n){const t=`${(0,a.E)(e)}/api/v1/instance`,c=n?(0,a.I)(n):null;return(0,s.U2)(t,c,{timeout:s.EH})}}}]);
//# sourceMappingURL=2307.4f07cc1e50d4e3f16719.2307.js.map