(this.webpackChunksemaphore=this.webpackChunksemaphore||[]).push([[2284],{8085:function(e,t,n){var i,s,r,o;r=function(){var e=/^;\s*([^"=]+)=(?:"([^"]+)"|([^";,]+)(?:[;,]|$))/,t=/^<([^>]*)>/,n=/^\s*,\s*/;return{parse:function(i,s){for(var r,o,a,l=s&&s.extended||!1,c=[];i&&(i=i.trim(),o=t.exec(i));){for(var m={link:o[1]},u=(i=i.slice(o[0].length)).match(n);i&&(!u||u.index>0)&&(r=e.exec(i));)u=(i=i.slice(r[0].length)).match(n),"rel"===r[1]||"rev"===r[1]?(a=(r[2]||r[3]).split(/\s+/),m[r[1]]=a):m[r[1]]=r[2]||r[3];c.push(m),i=i.replace(n,"")}return l?c:c.reduce((function(e,t){return t.rel&&t.rel.forEach((function(n){e[n]=t.link})),e}),{})},stringify:function(e){var t=Object.keys(e).reduce((function(t,n){return t[e[n]]=t[e[n]]||[],t[e[n]].push(n),t}),{});return Object.keys(t).reduce((function(e,n){return e.concat("<"+n+'>; rel="'+t[n].join(" ")+'"')}),[]).join(", ")}}},o=this,e.exports?e.exports=r():"function"==typeof o.define&&o.define.amd?void 0===(s="function"==typeof(i=r)?i.call(t,n,t,e):i)||(e.exports=s):o.li=r()},2284:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ve});var i=n(4178),s=n(5277);function r(e,t){var n,s,r=e._slotted.default;return{c(){n=(0,i.az)("h1"),this.h()},l(e){n=(0,i.d$)(e,"H1",{class:!0},!1),(0,i.pI)(n).forEach(i.r2),this.h()},h(){n.className=s=t.className||""},m(e,t){(0,i.$T)(e,n,t),r&&(0,i.R3)(n,r)},p(e,t){e.className&&s!==(s=t.className||"")&&(n.className=s)},d(e){e&&(0,i.r2)(n),r&&(0,i.R_)(n,r)}}}function o(e,t){var n,s,r=e._slotted.default;return{c(){n=(0,i.az)("h2"),this.h()},l(e){n=(0,i.d$)(e,"H2",{class:!0},!1),(0,i.pI)(n).forEach(i.r2),this.h()},h(){n.className=s=t.className||""},m(e,t){(0,i.$T)(e,n,t),r&&(0,i.R3)(n,r)},p(e,t){e.className&&s!==(s=t.className||"")&&(n.className=s)},d(e){e&&(0,i.r2)(n),r&&(0,i.R_)(n,r)}}}function a(e){if((0,i.S1)(this,e),this._state=(0,i.f0)({},e.data),this._intro=!0,this._slotted=e.slots||{},this._fragment=function(e,t){var n;function s(e){return 2===e.level?o:r}var a=s(t),l=a(e,t);return{c(){l.c(),n=(0,i.Yr)()},l(e){l.l(e),n=(0,i.Yr)()},m(e,t){l.m(e,t),(0,i.$T)(e,n,t)},p(t,i){a===(a=s(i))&&l?l.p(t,i):(l.d(1),(l=a(e,i)).c(),l.m(n.parentNode,n))},d(e){l.d(e),e&&(0,i.r2)(n)}}}(this,this._state),e.target){var t=(0,i.pI)(e.target);e.hydrate?this._fragment.l(t):this._fragment.c(),t.forEach(i.r2),this._mount(e.target,e.anchor)}}(0,i.f0)(a.prototype,i.uS);const l=a;var c=n(2270),m=n(1372),u=n(5984),d=n(9076),h=n(7031),f=n(8183),p=n(6637),g=n(4977),T=n(4285),y=n(1162),I=n(2502),w=n(4358),v=n(9109),_=n(4034),S=n(1505),$=n(9970);function b(e,t){const n=[],i=[],s=function(e,t){const n=new Map;for(const i of e)n.set(t(i),i);return n}(e,(e=>e.id)),r=function(e,t){const n=new Map;for(const i of e){const e=t(i);n.has(e)?n.get(e).push(i):n.set(e,[i])}return n}(e,(e=>e.replyId)),o=s.get(t);if(!o)return e;let a=o;do{a=s.get(a.replyId),a&&n.unshift(a)}while(a);const l=[o];for(;l.length;){const e=l.shift(),t=(r.get(e.id)||[]).sort(g.gV);Array.prototype.unshift.apply(l,t),e.id!==o.id&&i.push(e)}const c=e=>{let n=e;for(;;){if(n.accountId!==o.accountId)return!1;const e=s.get(n.replyId);if(!e)break;n=e}return n.id===t},m=[],u=[];for(const d of i)(c(d)?m:u).push(d);return(0,p.z)(n,[o],m,u)}var k=n(8085);const L=e=>e.id;async function A(e,t,n){await y.F.insertTimelineItems(e,t,n),t.startsWith("status/")&&n.forEach((e=>{(0,w.j)("statusUpdated",e)}))}async function P(e,t,n){const i=await(0,I.lR)(e,t,n);return await y.F.insertStatus(e,i),(0,w.j)("statusUpdated",i),i}async function N(e,t,n){const i=n.split("/").slice(-1)[0],s=await y.F.getStatus(e,i);if(!s)return async function(e,t,n){const[i,s]=await Promise.all([(0,I.lR)(e,t,n),(0,I.j7)(e,t,n)]);return(0,p.z)(s.ancestors,i,s.descendants)}(e,t,i);if(!s.in_reply_to_id)return async function(e,t,n,i){const[s,r]=await Promise.all([P(e,t,i),(0,I.j7)(e,t,i)]);await y.F.insertTimelineItems(e,n,(0,p.z)(r.ancestors,s,r.descendants)),(0,S.b)(e,n,(0,p.z)(r.ancestors,r.descendants))}(e,t,n,i),[s];(0,$.F)((()=>P(e,t,i)));const r=await(0,I.j7)(e,t,i);return(0,p.z)(r.ancestors,s,r.descendants)}async function C(e,t,n){n.length,(0,f.B)("addPagedTimelineItemSummaries");const i=n.map((t=>(0,_.o)(t,e)));await async function(e,t,n){const i=s.h.getForTimeline(e,t,"timelineItemSummaries"),r=(0,T.mN)((0,p.z)(i||[],n),L);(0,T.Xy)(i,r)||s.h.setForTimeline(e,t,{timelineItemSummaries:r})}(e,t,i),(0,f.s)("addPagedTimelineItemSummaries")}async function F(e,t,n,i){(0,f.B)("fetchTimelineItems");const{lastTimelineItemId:r}=s.h.get();let o,a=!1;if(i)try{o=await async function(e,t,n,i){if(n.startsWith("status/"))return N(e,t,n);{const{items:s}=await(0,d.V)(e,t,n,i,null,v.L);return s}}(e,t,n,r),await A(e,n,o)}catch(l){console.error(l),h.A.say("Internet request failed. Showing offline content."),o=await y.F.getTimeline(e,n,r,v.L),a=!0}else o=await y.F.getTimeline(e,n,r,v.L),a=!0;return(0,f.s)("fetchTimelineItems"),{items:o,stale:a}}async function B(e,t,n,i){const r=s.h.getForTimeline(e,t,"timelineItemSummaries"),o=s.h.getForTimeline(e,t,"timelineItemSummariesAreStale"),a=(0,T.mN)((0,p.e)(r||[],n,g.gV),L);(0,T.Xy)(r,a)||s.h.setForTimeline(e,t,{timelineItemSummaries:a}),o!==i&&s.h.setForTimeline(e,t,{timelineItemSummariesAreStale:i})}async function z(){(0,f.B)("fetchTimelineItemsAndPossiblyFallBack");const{currentTimeline:e,currentInstance:t,accessToken:n,online:i}=s.h.get();if("favorites"===e||"bookmarks"===e)await async function(e,t,n){const{timelineNextPageId:i}=s.h.get(),{items:r,headers:o}=await(0,d.V)(e,t,n,i,null,v.L),a=o.get("Link"),l=k.parse(a),c=l&&l.next,m=c&&new URL(c).searchParams.get("max_id");s.h.setForTimeline(e,n,{timelineNextPageId:m}),await A(e,n,r),await C(e,n,r)}(t,n,e);else{const{items:s,stale:r}=await F(t,n,e,i);await async function(e,t,n,i){n.length,(0,f.B)("addTimelineItemSummaries");const s=n.map((t=>(0,_.o)(t,e)));B(e,t,s,i),(0,f.s)("addTimelineItemSummaries")}(t,e,s,r)}(0,f.s)("fetchTimelineItemsAndPossiblyFallBack")}async function V(e,t){s.h.setForTimeline(e,t,{runningUpdate:!0}),await z(),s.h.setForTimeline(e,t,{runningUpdate:!1})}async function M(e,t){(0,f.B)("showMoreItemsForTimeline");let n=s.h.getForTimeline(e,t,"timelineItemSummariesToAdd")||[];n=n.sort(g.gV).reverse(),B(e,t,n,!1),s.h.setForTimeline(e,t,{timelineItemSummariesToAdd:[],shouldShowHeader:!1,showHeader:!1}),(0,f.s)("showMoreItemsForTimeline")}function R(){const{currentInstance:e,currentTimeline:t}=s.h.get();return M(e,t)}var x=n(9961);var E={observe:m.N7,onClickLoadMore(e){e.preventDefault(),e.stopPropagation();const{currentInstance:t,currentTimeline:n}=this.store.get();V(t,n);try{const e=document.querySelector(".virtual-list").children;e[e.length-2].querySelector("article").focus()}catch(e){console.error(e)}}};function H(){let e;this.observe("showLoading",(t=>{t?e=setTimeout((()=>{e=void 0,(0,x.y)("Loading more…")}),1e3):e&&clearTimeout(e)}))}function U(e){var t;if((0,i.S1)(this,e),this.store=s.h,this._state=(0,i.f0)(this.store._init(["timelineInitialized","runningUpdate","disableInfiniteScroll"]),e.data),this.store._add(this,["timelineInitialized","runningUpdate","disableInfiniteScroll"]),this._recompute({$timelineInitialized:1,$runningUpdate:1,$disableInfiniteScroll:1},this._state),this._intro=!0,this._handlers.destroy=[i.iT],document.getElementById("svelte-sry1lr-style")||((t=(0,i.az)("style")).id="svelte-sry1lr-style",t.textContent=".loading-footer.svelte-sry1lr{padding:20px 0;display:flex;align-items:center;justify-content:center;position:relative}.loading-wrapper.svelte-sry1lr{flex:1;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.2s linear}.loading-wrapper.shown.svelte-sry1lr{opacity:1;pointer-events:auto}.loading-footer-info.svelte-sry1lr{margin-left:20px;font-size:1.3em}.button-wrapper.svelte-sry1lr{position:absolute;left:0;right:0;bottom:0;top:0;display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:none}.button-wrapper.shown.svelte-sry1lr{opacity:1;pointer-events:auto;transition:opacity 0.2s linear 0.2s}",(0,i.R3)(document.head,t)),this._fragment=function(e,t){var n,s,r,o,a,l,c,m,d,h,f,p,g,T,y={size:48,animate:t.showLoading},I=new u.Z({root:e.root,store:e.store,data:y});function w(t){e.onClickLoadMore(t)}return{c(){n=(0,i.az)("div"),s=(0,i.az)("div"),I._fragment.c(),r=(0,i.rw)("\n    "),o=(0,i.az)("span"),a=(0,i.rw)("Loading more…"),m=(0,i.rw)("\n  "),d=(0,i.az)("div"),h=(0,i.az)("button"),f=(0,i.rw)("Load more"),this.h()},l(e){n=(0,i.d$)(e,"DIV",{class:!0},!1);var t=(0,i.pI)(n);s=(0,i.d$)(t,"DIV",{class:!0,"aria-hidden":!0},!1);var l=(0,i.pI)(s);I._fragment.l(l),r=(0,i.M4)(l,"\n    "),o=(0,i.d$)(l,"SPAN",{class:!0},!1);var c=(0,i.pI)(o);a=(0,i.M4)(c,"Loading more…"),c.forEach(i.r2),l.forEach(i.r2),m=(0,i.M4)(t,"\n  "),d=(0,i.d$)(t,"DIV",{class:!0,"aria-hidden":!0},!1);var u=(0,i.pI)(d);h=(0,i.d$)(u,"BUTTON",{type:!0,class:!0},!1);var p=(0,i.pI)(h);f=(0,i.M4)(p,"Load more"),p.forEach(i.r2),u.forEach(i.r2),t.forEach(i.r2),this.h()},h(){o.className="loading-footer-info svelte-sry1lr",s.className=l="loading-wrapper "+(t.showLoading?"shown":"")+" svelte-sry1lr",(0,i.P$)(s,"aria-hidden",c=!t.showLoading),(0,i.NH)(h,"click",w),h.type="button",h.className="primary",d.className=p="button-wrapper "+(t.showLoadButton?"shown":"")+" svelte-sry1lr",(0,i.P$)(d,"aria-hidden",g=!t.showLoadButton),n.className=T="loading-footer "+(t.shown?"":"hidden")+" svelte-sry1lr"},m(e,t){(0,i.$T)(e,n,t),(0,i.R3)(n,s),I._mount(s,null),(0,i.R3)(s,r),(0,i.R3)(s,o),(0,i.R3)(o,a),(0,i.R3)(n,m),(0,i.R3)(n,d),(0,i.R3)(d,h),(0,i.R3)(h,f)},p(e,t){var r={};e.showLoading&&(r.animate=t.showLoading),I._set(r),e.showLoading&&l!==(l="loading-wrapper "+(t.showLoading?"shown":"")+" svelte-sry1lr")&&(s.className=l),e.showLoading&&c!==(c=!t.showLoading)&&(0,i.P$)(s,"aria-hidden",c),e.showLoadButton&&p!==(p="button-wrapper "+(t.showLoadButton?"shown":"")+" svelte-sry1lr")&&(d.className=p),e.showLoadButton&&g!==(g=!t.showLoadButton)&&(0,i.P$)(d,"aria-hidden",g),e.shown&&T!==(T="loading-footer "+(t.shown?"":"hidden")+" svelte-sry1lr")&&(n.className=T)},d(e){e&&(0,i.r2)(n),I.destroy(),(0,i.ys)(h,"click",w)}}}(this,this._state),this.root._oncreate.push((()=>{H.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),e.target){var n=(0,i.pI)(e.target);e.hydrate?this._fragment.l(n):this._fragment.c(),n.forEach(i.r2),this._mount(e.target,e.anchor),(0,i.yl)(this)}}(0,i.f0)(U.prototype,i.uS),(0,i.f0)(U.prototype,E),U.prototype._recompute=function(e,t){(e.$timelineInitialized||e.$runningUpdate||e.$disableInfiniteScroll)&&this._differs(t.shown,t.shown=function({$timelineInitialized:e,$runningUpdate:t,$disableInfiniteScroll:n}){return e&&(n||t)}(t))&&(e.shown=!0),e.$runningUpdate&&this._differs(t.showLoading,t.showLoading=function({$runningUpdate:e}){return e}(t))&&(e.showLoading=!0),(e.$runningUpdate||e.$disableInfiniteScroll)&&this._differs(t.showLoadButton,t.showLoadButton=function({$runningUpdate:e,$disableInfiniteScroll:t}){return!e&&t}(t))&&(e.showLoadButton=!0)};const j=U;var W=n(6633);var D={onClick(e){const{onClick:t}=this.get();t&&t(e)}};function Z(e){var t;if((0,i.S1)(this,e),this._state=(0,i.f0)({},e.data),this._recompute({count:1},this._state),this._intro=!0,document.getElementById("svelte-1iuasny-style")||((t=(0,i.az)("style")).id="svelte-1iuasny-style",t.textContent=".more-items-header.svelte-1iuasny{display:flex;padding:5px;align-items:center;justify-content:center}",(0,i.R3)(document.head,t)),this._fragment=function(e,t){var n,s,r;function o(t){e.onClick(t)}return{c(){n=(0,i.az)("div"),s=(0,i.az)("button"),r=(0,i.rw)(t.showMoreLabel),this.h()},l(e){n=(0,i.d$)(e,"DIV",{class:!0},!1);var o=(0,i.pI)(n);s=(0,i.d$)(o,"BUTTON",{class:!0,type:!0},!1);var a=(0,i.pI)(s);r=(0,i.M4)(a,t.showMoreLabel),a.forEach(i.r2),o.forEach(i.r2),this.h()},h(){(0,i.NH)(s,"click",o),s.className="primary",s.type="button",n.className="more-items-header svelte-1iuasny"},m(e,t){(0,i.$T)(e,n,t),(0,i.R3)(n,s),(0,i.R3)(s,r)},p(e,t){e.showMoreLabel&&(0,i.a_)(r,t.showMoreLabel)},d(e){e&&(0,i.r2)(n),(0,i.ys)(s,"click",o)}}}(this,this._state),e.target){var n=(0,i.pI)(e.target);e.hydrate?this._fragment.l(n):this._fragment.c(),n.forEach(i.r2),this._mount(e.target,e.anchor)}}(0,i.f0)(Z.prototype,i.uS),(0,i.f0)(Z.prototype,D),Z.prototype._recompute=function(e,t){e.count&&this._differs(t.showMoreLabel,t.showMoreLabel=function({count:e}){return(0,W.A)(["Show ",["count"]," more"],{count:e})}(t))&&(e.showMoreLabel=!0)};const q=Z;function X(e){var t,n,s,r;if((0,i.S1)(this,e),this._state=(0,i.f0)({},e.data),this._intro=!0,this._fragment=(t=this,n=this._state,s={count:n.virtualProps.count,onClick:n.virtualProps.onClick},r=new q({root:t.root,store:t.store,data:s}),{c(){r._fragment.c()},l(e){r._fragment.l(e)},m(e,t){r._mount(e,t)},p(e,t){var n={};e.virtualProps&&(n.count=t.virtualProps.count),e.virtualProps&&(n.onClick=t.virtualProps.onClick),r._set(n)},d(e){r.destroy(e)}}),e.target){var o=(0,i.pI)(e.target);e.hydrate?this._fragment.l(o):this._fragment.c(),o.forEach(i.r2),this._mount(e.target,e.anchor),(0,i.yl)(this)}}(0,i.f0)(X.prototype,i.uS);const J=X;var O=n(2213),Y=n(9517);let K;function G(){return K||(K=document.getElementById("main-nav")),K.clientHeight}function Q(e){const t=(0,O.Vp)(),n=G();let i=-1,s=-1;const r=e.length;let o=-1;for(;++o<r;){const a=e[o];if(!a)continue;const l=a.getBoundingClientRect();if(l.top<t&&l.bottom>=n){i=o,s=l.top<n&&o<r-1?o+1:o;break}}return{first:i,firstComplete:s}}var ee=n(5193);const te=e=>document.getElementById(e),ne=e=>e.getAttribute("id"),ie="global";var se={onKeyDown(e){if((e=>{const{target:t,key:n}=e;return t&&"INPUT"===t.tagName&&"radio"===t.type&&("ArrowUp"===n||"ArrowDown"===n)})(e))return;if("z"===e.key&&this.store.get().currentTimeline.startsWith("status/")){e.stopPropagation(),e.preventDefault();const{spoilersShown:t}=this.get();return(0,w.j)("toggleAllSpoilers",!t),void this.set({spoilersShown:!t})}if("j"===e.key||"ArrowDown"===e.key)return e.stopPropagation(),e.preventDefault(),void this.changeActiveItem(1,e.timeStamp);if("k"===e.key||"ArrowUp"===e.key)return e.stopPropagation(),e.preventDefault(),void this.changeActiveItem(-1,e.timeStamp);let t=this.checkActiveItem(e.timeStamp);if(!t){const{elements:e}=this.get(),n=Q(e).first;n>=0&&(t=ne(e[n]))}t&&(0,ee.kS)(t,e)},changeActiveItem(e,t){const{elements:n}=this.get();let i=-1,s=this.checkActiveItem(t);if(s){const e=n.length;let t=-1;for(;++t<e;)if(ne(n[t])===s){i=t;break}}if(0===i&&-1===e)return s=null,this.set({activeItemKey:s}),void(0,Y.l)((0,O.JX)(),0,!1,!1);if(-1===i){const{first:t,firstComplete:s}=Q(n);i=e>0?s:t}else i+=e;i>=0&&i<n.length&&(s=ne(n[i]),this.setActiveItem(s,t),function(e){const t=e.getBoundingClientRect(),n=G(),i=(0,O.Vp)();let s=0;if(t.top<n)s=n;else{if(!(t.bottom>i))return;{const e=t.bottom-t.top;s=i-n>e?i-e:n}}const r=(0,O.JX)(),o=r.scrollTop;(0,Y.l)(r,o+t.top-s,!1,!1)}(te(s)))},checkActiveItem(e){const t=document.activeElement;if(!t)return null;const n=t.closest("article");if(!n)return null;const i=n.getAttribute("id");if(!i)return null;const{activeItemChangeTime:s}=this.get();return e-s>600&&!function(e){if(!e)return!1;const t=e.getBoundingClientRect(),n=(0,O.Vp)(),i=G();return t.top<n&&t.bottom>=i}(te(i))?(this.setActiveItem(null,0),null):i},setActiveItem(e,t){this.set({activeItemChangeTime:t});try{te(e).focus({preventScroll:!0})}catch(n){console.error("Ignored focus error",n)}}};function re(){(0,ee._x)(ie,this)}function oe(){(0,ee.jN)(ie,this)}function ae(e){if((0,i.S1)(this,e),this.store=s.h,this._state=(0,i.f0)({activeItemChangeTime:0,elements:document.getElementsByClassName("shortcut-list-item"),spoilersShown:!1},e.data),this._intro=!0,this._handlers.destroy=[oe],this._fragment=(this._state,{c:i.ZT,l:i.ZT,m:i.ZT,p:i.ZT,d:i.ZT}),this.root._oncreate.push((()=>{re.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),e.target){var t=(0,i.pI)(e.target);e.hydrate?this._fragment.l(t):this._fragment.c(),t.forEach(i.r2),this._mount(e.target,e.anchor),(0,i.yl)(this)}}(0,i.f0)(ae.prototype,i.uS),(0,i.f0)(ae.prototype,se);const le=ae;var ce=n(7539);var me=n(3609),ue=n(6949);function de(e,t,n){let i=Promise.resolve();async function s(i){(0,f.B)(`fetchFromIndexedDB-${i}`);try{const s=await("notifications"===t?async function(e,t,n,i){return{timelineType:t,timelineValue:n,notification:await y.F.getNotification(e,i)}}(e,t,n,i):async function(e,t,n,i){return{timelineType:t,timelineValue:n,status:await y.F.getStatus(e,i)}}(e,t,n,i));return s}finally{(0,f.s)(`fetchFromIndexedDB-${i}`)}}return(0,ue.B)(),e=>{const t=async function(e){const t=await s(e);return await(0,ue.F)(t),t}(e);return new Promise(((e,n)=>{i=i.then((()=>t)).then(e,n)}))}}var he=n(8382),fe=n(173),pe=n(8137);var ge=n(8565);var Te={observe:m.N7,initialize(){const{initializeStarted:e}=this.get();e||(this.set({initializeStarted:!0}),(0,f.B)("initializeTimeline"),(0,me.M)((()=>{this.store.set({timelineInitialized:!0}),(0,f.s)("initializeTimeline")})))},onScrollTopChanged(e){this.set({scrollTop:e})},onScrollToBottom(){const{timelineType:e}=this.get(),{timelineInitialized:t,runningUpdate:n,disableInfiniteScroll:i}=this.store.get();if(!t||n||i||"status"===e)return;const{currentInstance:s}=this.store.get(),{timeline:r}=this.get();V(s,r)},onScrollToTop(){const{shouldShowHeader:e}=this.store.get();e&&this.store.setForCurrentTimeline({showHeader:!0,shouldShowHeader:!1})},setupStreaming(){const{currentInstance:e,disableInfiniteScroll:t}=this.store.get(),{timeline:n,timelineType:i}=this.get(),r=()=>{const{itemIdsToAdd:r}=this.get();if(!r||!r.length)return;(0,f.B)("handleItemIdsToAdd");const{scrollTop:o}=this.get(),{shouldShowHeader:a,showHeader:l}=this.store.get();"status"===i?async function(e,t){(0,f.B)("showMoreItemsForThread");const n=s.h.getForTimeline(e,t,"timelineItemSummariesToAdd"),i=s.h.getForTimeline(e,t,"timelineItemSummaries"),r=new Set(i.map((e=>e.id)));for(const s of n)r.has(s.id)||i.push(s);const o=t.split("/").slice(-1)[0],a=await b(i,o);s.h.setForTimeline(e,t,{timelineItemSummariesToAdd:[],timelineItemSummaries:a}),(0,f.s)("showMoreItemsForThread")}(e,n):t||0!==o||a||l?(this.store.setForTimeline(e,n,{shouldShowHeader:!0}),t&&this.store.setForTimeline(e,n,{showHeader:!0})):M(e,n),(0,f.s)("handleItemIdsToAdd")};this.observe("itemIdsToAdd",((e,t)=>{e&&e.length&&!(0,T.Xy)(e,t)&&(0,$.F)(r)}))},setupAsyncComponents(){this.observe("componentsPromise",(async e=>{if(e){const t=await e;this.set({components:t})}}))},onNoNeedToScroll(){this.store.set({timelinePreinitialized:!0})},showMoreAndScrollToTop:function(){R();const{currentInstance:e,timelineItemSummaries:t,currentTimelineType:n,currentTimelineValue:i}=s.h.get(),r=t&&t[0];if(!r)return;const o="notifications"===n&&r.id,a="notifications"!==n&&r.id;(0,he.k)(!1);const l=(0,fe.L)(e,n,i,o,a);(0,pe.w)(l)}};function ye(){!async function(){(0,f.B)("setupTimeline");const{timelineItemSummaries:e,timelineItemSummariesAreStale:t,currentTimeline:n}=s.h.get();(!e||t||n.startsWith("status/"))&&await z(),(0,f.s)("setupTimeline")}(),this.setupStreaming(),this.setupAsyncComponents()}function Ie(e,t){var n,s=t.components.listComponent;function r(t){var n={component:t.components.listItemComponent,realm:t.$currentInstance+"/"+t.timeline,makeProps:t.makeProps,items:t.itemIds,showFooter:!0,footerComponent:t.LoadingFooter,showHeader:t.$showHeader,headerComponent:t.MoreHeaderVirtualWrapper,headerProps:t.headerProps,scrollToItem:t.scrollToItem};return{root:e.root,store:e.store,data:n}}if(s)var o=new s(r(t));function a(t){e.onScrollToBottom()}function l(t){e.onScrollToTop()}function c(t){e.onScrollTopChanged(t)}function m(t){e.initialize()}function u(t){e.onNoNeedToScroll()}return o&&o.on("scrollToBottom",a),o&&o.on("scrollToTop",l),o&&o.on("scrollTopChanged",c),o&&o.on("initialized",m),o&&o.on("noNeedToScroll",u),{c(){o&&o._fragment.c(),n=(0,i.Yr)()},l(e){o&&o._fragment.l(e),n=(0,i.Yr)()},m(e,t){o&&o._mount(e,t),(0,i.$T)(e,n,t)},p(e,t){var i={};e.components&&(i.component=t.components.listItemComponent),(e.$currentInstance||e.timeline)&&(i.realm=t.$currentInstance+"/"+t.timeline),e.makeProps&&(i.makeProps=t.makeProps),e.itemIds&&(i.items=t.itemIds),e.LoadingFooter&&(i.footerComponent=t.LoadingFooter),e.$showHeader&&(i.showHeader=t.$showHeader),e.MoreHeaderVirtualWrapper&&(i.headerComponent=t.MoreHeaderVirtualWrapper),e.headerProps&&(i.headerProps=t.headerProps),e.scrollToItem&&(i.scrollToItem=t.scrollToItem),s!==(s=t.components.listComponent)?(o&&o.destroy(),s?((o=new s(r(t)))._fragment.c(),o._mount(n.parentNode,n),o.on("scrollToBottom",a),o.on("scrollToTop",l),o.on("scrollTopChanged",c),o.on("initialized",m),o.on("noNeedToScroll",u)):o=null):s&&o._set(i)},d(e){e&&(0,i.r2)(n),o&&o.destroy(e)}}}function we(e){if((0,i.S1)(this,e),this.store=s.h,this._state=(0,i.f0)((0,i.f0)(this.store._init(["currentInstance","currentTimelineType","currentTimelineValue","firstTimelineItemId","filteredTimelineItemSummaries","filteredTimelineItemSummariesToAdd","showHeader"]),{LoadingFooter:j,MoreHeaderVirtualWrapper:J,Status:c.Z,scrollTop:0,components:void 0}),e.data),this.store._add(this,["currentInstance","currentTimelineType","currentTimelineValue","firstTimelineItemId","filteredTimelineItemSummaries","filteredTimelineItemSummariesToAdd","showHeader"]),this._recompute({$currentTimelineType:1,timelineType:1,$currentTimelineValue:1,$currentInstance:1,timelineValue:1,timeline:1,$firstTimelineItemId:1,$filteredTimelineItemSummaries:1,$filteredTimelineItemSummariesToAdd:1,itemIdsToAdd:1},this._state),this._intro=!0,this._handlers.destroy=[i.iT],this._fragment=function(e,t){var n,s,r,o,a,c={className:"sr-only",level:t.headingLevel},m=new l({root:e.root,store:e.store,slots:{default:(0,i.xJ)()},data:c}),u=t.components&&Ie(e,t),d={realm:t.focusRealm},h=new ge.Z({root:e.root,store:e.store,slots:{default:(0,i.xJ)()},data:d}),f=new ce.Z({root:e.root,store:e.store,data:{scope:"global",key:"."}});f.on("pressed",(function(t){e.showMoreAndScrollToTop()}));var p=new le({root:e.root,store:e.store});return{c(){n=(0,i.rw)(t.label),m._fragment.c(),s=(0,i.rw)("\n"),r=(0,i.az)("div"),u&&u.c(),h._fragment.c(),o=(0,i.rw)("\n"),f._fragment.c(),a=(0,i.rw)("\n"),p._fragment.c(),this.h()},l(e){n=(0,i.M4)(e,t.label),m._fragment.l(e),s=(0,i.M4)(e,"\n"),r=(0,i.d$)(e,"DIV",{class:!0,role:!0},!1);var l=(0,i.pI)(r);u&&u.l(l),l.forEach(i.r2),h._fragment.l(e),o=(0,i.M4)(e,"\n"),f._fragment.l(e),a=(0,i.M4)(e,"\n"),p._fragment.l(e),this.h()},h(){r.className="timeline",(0,i.P$)(r,"role","feed")},m(e,t){(0,i.R3)(m._slotted.default,n),m._mount(e,t),(0,i.$T)(e,s,t),(0,i.R3)(h._slotted.default,r),u&&u.m(r,null),h._mount(e,t),(0,i.$T)(e,o,t),f._mount(e,t),(0,i.$T)(e,a,t),p._mount(e,t)},p(t,s){t.label&&(0,i.a_)(n,s.label);var o={};t.headingLevel&&(o.level=s.headingLevel),m._set(o),s.components?u?u.p(t,s):((u=Ie(e,s)).c(),u.m(r,null)):u&&(u.d(1),u=null);var a={};t.focusRealm&&(a.realm=s.focusRealm),h._set(a)},d(e){m.destroy(e),e&&(0,i.r2)(s),u&&u.d(),h.destroy(e),e&&(0,i.r2)(o),f.destroy(e),e&&(0,i.r2)(a),p.destroy(e)}}}(this,this._state),this.root._oncreate.push((()=>{ye.call(this),this.fire("update",{changed:(0,i.lZ)({},this._state),current:this._state})})),e.target){var t=(0,i.pI)(e.target);e.hydrate?this._fragment.l(t):this._fragment.c(),t.forEach(i.r2),this._mount(e.target,e.anchor),(0,i.yl)(this)}}(0,i.f0)(we.prototype,i.uS),(0,i.f0)(we.prototype,Te),we.prototype._recompute=function(e,t){e.$currentTimelineType&&this._differs(t.timelineType,t.timelineType=function({$currentTimelineType:e}){return e}(t))&&(e.timelineType=!0),e.timelineType&&this._differs(t.componentsPromise,t.componentsPromise=function({timelineType:e}){return Promise.all(["status"===e?n.e(3948).then(n.bind(n,3948)).then((e=>e.default)):Promise.all([n.e(9225),n.e(8619)]).then(n.bind(n,8619)).then((e=>e.default)),"notifications"===e?n.e(1212).then(n.bind(n,1212)).then((e=>e.default)):n.e(1793).then(n.bind(n,8885)).then((e=>e.default))]).then((e=>({listComponent:e[0],listItemComponent:e[1]})))}(t))&&(e.componentsPromise=!0),e.$currentTimelineValue&&this._differs(t.timelineValue,t.timelineValue=function({$currentTimelineValue:e}){return e}(t))&&(e.timelineValue=!0),(e.$currentInstance||e.timelineType||e.timelineValue)&&this._differs(t.makeProps,t.makeProps=function({$currentInstance:e,timelineType:t,timelineValue:n}){return de(e,t,n)}(t))&&(e.makeProps=!0),(e.timeline||e.$currentInstance||e.timelineType||e.timelineValue)&&this._differs(t.label,t.label=function({timeline:e,$currentInstance:t,timelineType:n,timelineValue:i}){if(v.q[e])return(0,W.A)(["Statuses: ",["timeline"]," timeline on ",["instance"]],{timeline:v.q[e].label,instance:t});switch(n){case"tag":return(0,W.A)(["Statuses: #",["hashtag"]," hashtag"],{hashtag:i});case"status":return"Statuses: thread";case"account":return"Statuses: account timeline";case"list":return"Statuses: list";case"notifications":return(0,W.A)(["Notifications on ",["instance"]],{instance:t})}}(t))&&(e.label=!0),(e.timelineType||e.timelineValue||e.$firstTimelineItemId)&&this._differs(t.scrollToItem,t.scrollToItem=function({timelineType:e,timelineValue:t,$firstTimelineItemId:n}){return"status"===e&&n&&t!==n&&t}(t))&&(e.scrollToItem=!0),e.$filteredTimelineItemSummaries&&this._differs(t.itemIds,t.itemIds=function({$filteredTimelineItemSummaries:e}){return e&&e.map((e=>e.id))}(t))&&(e.itemIds=!0),e.$filteredTimelineItemSummariesToAdd&&this._differs(t.itemIdsToAdd,t.itemIdsToAdd=function({$filteredTimelineItemSummariesToAdd:e}){return e&&e.map((e=>e.id))}(t))&&(e.itemIdsToAdd=!0),e.itemIdsToAdd&&this._differs(t.headerProps,t.headerProps=function({itemIdsToAdd:e}){return{count:e?e.length:0,onClick:R}}(t))&&(e.headerProps=!0),(e.$currentInstance||e.timeline)&&this._differs(t.focusRealm,t.focusRealm=function({$currentInstance:e,timeline:t}){return`${e}-${t}`}(t))&&(e.focusRealm=!0),(e.timeline||e.timelineType)&&this._differs(t.headingLevel,t.headingLevel=function({timeline:e,timelineType:t}){return"home"===e||"status"===t?2:1}(t))&&(e.headingLevel=!0)};const ve=we},9076:(e,t,n)=>{"use strict";n.d(t,{V:()=>r});var i=n(385),s=n(4886);async function r(e,t,n,r,o,a){const l=function(e){switch(e){case"local":case"federated":return"timelines/public";case"home":return"timelines/home";case"notifications":case"notifications/mentions":return"notifications";case"favorites":return"favourites";case"direct":return"conversations";case"bookmarks":return"bookmarks"}if(e.startsWith("tag/"))return"timelines/tag";if(e.startsWith("account/"))return"accounts";if(e.startsWith("list/"))return"timelines/list";throw new Error(`Invalid timeline type: ${e}`)}(n);let c=`${(0,s.E)(e)}/api/v1/${l}`;n.startsWith("tag/")?c+="/"+n.split("/")[1]:n.startsWith("account/")?c+="/"+n.split("/")[1]+"/statuses":n.startsWith("list/")&&(c+="/"+n.split("/")[1]);const m={};o&&(m.since_id=o),r&&(m.max_id=r),a&&(m.limit=a),"local"===n&&(m.local=!0),n.startsWith("account/")&&(n.endsWith("media")?m.only_media=!0:m.exclude_replies=!n.endsWith("/with_replies")),"notifications/mentions"===n&&(m.exclude_types=["follow","favourite","reblog","poll","admin.sign_up","update","follow_request","admin.report"]),c+="?"+(0,i.pe)(m);let{json:u,headers:d}=await(0,i.SM)(c,(0,s.I)(t),{timeout:i.EH});return"direct"===n&&(u=u.map((e=>e.last_status)).filter(Boolean)),{items:u,headers:d}}},9109:(e,t,n)=>{"use strict";n.d(t,{L:()=>i,q:()=>s});const i=20,s={home:{name:"home",label:"Home"},local:{name:"local",label:"Local"},federated:{name:"federated",label:"Federated"}}},4977:(e,t,n)=>{"use strict";n.d(t,{Bu:()=>s,gV:()=>a,hC:()=>o});var i=n(85);function s(e,t){return(0,i.Sk)(e,t,"0")}function r(e){return s(e,30)}function o(e){const t=r(e);let n="";for(let i=0;i<t.length;i++){const e=170-t.charCodeAt(i);n+=String.fromCharCode(e)}return n}function a(e,t){const n=r(e.id),i=r(t.id);return n<i?-1:n===i?0:1}}}]);
//# sourceMappingURL=2284.46e3cd4754f09de1291f.2284.js.map