"use strict";(this.webpackChunksemaphore=this.webpackChunksemaphore||[]).push([[4026,7553],{5041:(t,e,n)=>{n.d(e,{d:()=>u});var s=n(1162);var i=n(5277),o=n(4285),a=n(9970);function r(t,e,n){const s=t=>n(t.id);["timelineItemSummaries","timelineItemSummariesToAdd"].forEach((n=>{const a=i.h.getAllTimelineData(t,n);Object.keys(a).forEach((r=>{const c=a[r];if(!e(r))return;const l=c.filter(s);(0,o.Xy)(c,l)||i.h.setForTimeline(t,r,{[n]:l})}))}))}async function c(t,e,n){!function(t,e){const n=new Set(e);r(t,(t=>"notifications"!==t),(t=>!n.has(t)))}(t,e),function(t,e){const n=new Set(e);r(t,(t=>"notifications"===t),(t=>!n.has(t)))}(t,n),await s.F.deleteStatusesAndNotifications(t,e,n)}async function l(t,e){const n=await async function(t,e){return s.F.getReblogsForStatus(t,e)}(t,e),i=Array.from(new Set([e].concat(n).filter(Boolean))),o=Array.from(new Set(await async function(t,e){return s.F.getNotificationIdsForStatuses(t,e)}(t,i)));await c(t,i,o)}function u(t,e){(0,a.F)((()=>{l(t,e)}))}},4989:(t,e,n)=>{n.d(e,{Z:()=>c});var s=n(5277),i=n(1370),o=n(1162),a=n(2954),r=n(85);async function c(t){const{verifyCredentials:e,loggedInInstances:n}=s.h.get();if(!(0,r.U2)(e,[t,"locked"]))return;const c=n[t].access_token;await(0,i.u)((async()=>(await(0,a._v)(t,c)).length),(()=>o.F.getFollowRequestCount(t)),(e=>o.F.setFollowRequestCount(t,e)),(e=>{const{followRequestCounts:n}=s.h.get();n[t]=e,s.h.set({followRequestCounts:n})}))}},8131:(t,e,n)=>{n.d(e,{L:()=>u,R:()=>l});var s=n(5277),i=n(385),o=n(4886);var a=n(1370),r=n(1162);async function c(t,e){const{loggedInInstances:n}=s.h.get(),a=n[t].access_token;await e((()=>function(t,e){const n=`${(0,o.E)(t)}/api/v1/lists`;return(0,i.U2)(n,(0,o.I)(e),{timeout:i.EH})}(t,a)),(()=>r.F.getLists(t)),(e=>r.F.setLists(t,e)),(e=>{const{instanceLists:n}=s.h.get();n[t]=e,s.h.set({instanceLists:n})}))}async function l(t){await c(t,a.u)}async function u(t){await c(t,a.o)}},2954:(t,e,n)=>{n.d(e,{_v:()=>o});var s=n(385),i=n(4886);async function o(t,e){const n=`${(0,i.E)(t)}/api/v1/follow_requests`;return(0,s.U2)(n,(0,i.I)(e),{timeout:s.EH})}},7662:(t,e,n)=>{n.d(e,{y:()=>a});var s=n(385),i=n(4886);function o(t,e,n,o,a,r,c,l){const u=`${(0,i.E)(e)}/api/${t}/search?`+(0,s.pe)({q:o,resolve:a,limit:r,exclude_unreviewed:!!c});return(0,s.U2)(u,(0,i.I)(n),{timeout:s.EH,signal:l})}async function a(t,e,n,s=!0,a=5,r=!1,c=null){try{return await async function(t,e,n,s,i,a,r){return o("v2",t,e,n,s,i,a,r)}(t,e,n,s,a,r,c)}catch(l){if(l&&404===l.status)return async function(t,e,n,s,a,r,c){const l=await o("v1",t,e,n,s,a,r,c);return l.hashtags=l.hashtags&&l.hashtags.map((e=>({name:e,url:`${(0,i.E)(t)}/tags/${e.toLowerCase()}`,history:[]}))),l}(t,e,n,s,a,r,c);throw l}}},9076:(t,e,n)=>{n.d(e,{V:()=>o});var s=n(385),i=n(4886);async function o(t,e,n,o,a,r){const c=function(t){switch(t){case"local":case"federated":return"timelines/public";case"home":return"timelines/home";case"notifications":case"notifications/mentions":return"notifications";case"favorites":return"favourites";case"direct":return"conversations";case"bookmarks":return"bookmarks"}if(t.startsWith("tag/"))return"timelines/tag";if(t.startsWith("account/"))return"accounts";if(t.startsWith("list/"))return"timelines/list";throw new Error(`Invalid timeline type: ${t}`)}(n);let l=`${(0,i.E)(t)}/api/v1/${c}`;n.startsWith("tag/")?l+="/"+n.split("/")[1]:n.startsWith("account/")?l+="/"+n.split("/")[1]+"/statuses":n.startsWith("list/")&&(l+="/"+n.split("/")[1]);const u={};a&&(u.since_id=a),o&&(u.max_id=o),r&&(u.limit=r),"local"===n&&(u.local=!0),n.startsWith("account/")&&(n.endsWith("media")?u.only_media=!0:u.exclude_replies=!n.endsWith("/with_replies")),"notifications/mentions"===n&&(u.exclude_types=["follow","favourite","reblog","poll","admin.sign_up","update","follow_request","admin.report"]),l+="?"+(0,s.pe)(u);let{json:h,headers:m}=await(0,s.SM)(l,(0,i.I)(e),{timeout:s.EH});return"direct"===n&&(h=h.map((t=>t.last_status)).filter(Boolean)),{items:h,headers:m}}},2625:(t,e,n)=>{n.d(e,{D:()=>a,Q:()=>o});var s=n(385),i=n(4886);function o(t,e){const n=`${(0,i.E)(t)}/api/v1/accounts/verify_credentials`;return(0,s.U2)(n,(0,i.I)(e),{timeout:s.EH})}function a(t,e,n){const o=`${(0,i.E)(t)}/api/v1/accounts/${n}`;return(0,s.U2)(o,(0,i.I)(e),{timeout:s.EH})}},4886:(t,e,n)=>{function s(t){return function(t){return t.startsWith("localhost:")||t.startsWith("127.0.0.1:")}(t)?`http://${t}`:`https://${t}`}function i(t){return{Authorization:`Bearer ${t}`}}n.d(e,{E:()=>s,I:()=>i})},7553:(t,e,n)=>{n.d(e,{B:()=>s});const s=()=>Promise.all([n.e(2936),n.e(1277),n.e(7539),n.e(7727),n.e(4285),n.e(7080),n.e(7323),n.e(1095),n.e(2644),n.e(5246)]).then(n.bind(n,5246)).then((t=>t.default))},370:(t,e,n)=>{n.d(e,{P:()=>i,f:()=>s});const s=432e6,i=3e5},9805:(t,e,n)=>{n.d(e,{Ay:()=>o,FO:()=>a,jN:()=>i});var s=n(7965);const i=`/emoji-${s.M}.json`,o=void 0,a="en-US"===s.M?"en":s.M},2650:(t,e,n)=>{n.d(e,{IO:()=>a,Ny:()=>s,_s:()=>u,aO:()=>r,j6:()=>c,lG:()=>l,wM:()=>o,zW:()=>i});const s="home",i="notifications",o="public",a="thread",r="account",c=[s,i,o,a,r],l=[{value:0,label:"Never"},{value:1800,label:"30 minutes"},{value:3600,label:"1 hour"},{value:21600,label:"6 hours"},{value:43200,label:"12 hours"},{value:86400,label:"1 day"},{value:604800,label:"7 days"}],u=0},8272:(t,e,n)=>{n.r(e);var s=n(85);function i(t){return t&&t[0]&&t[0].id}var o=n(8183);function a(t,e,n){t.compute(e,["currentInstance","currentTimeline",`timelineData_${e}`],((t,e,i)=>(0,s.U2)(i,[t,e],n)))}const r=new RegExp("(?:\\s|^)((?:@|:|#)[\\w\\+_\\-:]{2,})$");function c(t,e,n){t.compute(e,["currentInstance","currentComposeRealm",`autosuggestData_${e}`],((t,e,i)=>(0,s.U2)(i,[t,e],n)))}var l=n(5277);var u=n(2650);function h(t){t.compute("currentFilters",["unexpiredInstanceFilters","currentInstance"],((t,e)=>t[e]||[])),t.compute("unexpiredInstanceFilterRegexes",["unexpiredInstanceFilters"],(t=>Object.fromEntries(Object.entries(t).map((([t,e])=>[t,Object.fromEntries(u.j6.map((t=>{const n=e.filter((e=>e.context.includes(t)));if(!n.length)return;const s=(t=>new RegExp(t.map((t=>{let e=t.phrase.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return t.whole_word&&(/^[\w]/.test(e)&&(e=`\\b${e}`),/[\w]$/.test(e)&&(e=`${e}\\b`)),e})).join("|"),"i"))(n);return[t,s]})).filter(Boolean))])))))}var m=n(5061);const f=(t,e,n,s,i,o,a,r)=>c=>{if(c.filterContexts&&c.filterContexts.includes(r))return!1;switch(c.type){case"poll":return o;case"favourite":return s;case"reblog":return t;case"mention":return i;case"follow":return n;case"status":return a}return c.reblogId?t:!c.replyId||e};function d(t,e,n){t.compute(e,["currentInstance","instanceSettings","currentTimeline"],((t,e,i)=>{const o=n[i];return!o||(0,s.U2)(e,[t,o],!0)}))}function g(t,e,n){t.compute(e,["currentInstance","instanceSettings"],((t,e)=>(0,s.U2)(e,[t,n],!0)))}var p=n(2307),w=n(8131);class y{constructor(t){this.attempts=0,this.onReady=t}backoff(){const t=this.fibonacci(++this.attempts);setTimeout(this.onReady,t)}fibonacci(t){let e=1;if(t>e){let n=1;e=2;for(let s=2;s<t;s++){const t=n+e;n=e,e=t}}return Math.min(6e4,Math.floor(Math.random()*e*100))}reset(){this.attempts=0}}class S{constructor(t,e=[],n={}){this.url=t,this.protocols=e,this.reconnectEnabled=!0,this.listeners={},this.backoff=new y(this.onBackoffReady.bind(this)),(void 0===n.connect||n.connect)&&this.open()}open(t=!1){this.isReconnect=t;const e=this.ws&&this.ws.binaryType;this.ws=new WebSocket(this.url,this.protocols),this.ws.onclose=this.onCloseCallback.bind(this),this.ws.onerror=this.onErrorCallback.bind(this),this.ws.onmessage=this.onMessageCallback.bind(this),this.ws.onopen=this.onOpenCallback.bind(this),e&&(this.ws.binaryType=e)}onBackoffReady(){this.open(!0)}onCloseCallback(t){!this.isReconnect&&this.listeners.onclose&&this.listeners.onclose.apply(null,arguments),this.reconnectEnabled&&t.code<3e3&&this.backoff.backoff()}onErrorCallback(){this.listeners.onerror&&this.listeners.onerror.apply(null,arguments)}onMessageCallback(){this.listeners.onmessage&&this.listeners.onmessage.apply(null,arguments)}onOpenCallback(){this.listeners.onopen&&this.listeners.onopen.apply(null,arguments),this.isReconnect&&this.listeners.onreconnect&&this.listeners.onreconnect.apply(null,arguments),this.isReconnect=!1}get readyState(){return this.ws.readyState}close(t,e){void 0===t&&(t=1e3),this.reconnectEnabled=!1,this.ws.close(t,e)}send(t){this.ws.send(t)}set onclose(t){this.listeners.onclose=t}get onclose(){return this.listeners.onclose}set onerror(t){this.listeners.onerror=t}get onerror(){return this.listeners.onerror}set onmessage(t){this.listeners.onmessage=t}get onmessage(){return this.listeners.onmessage}set onopen(t){this.listeners.onopen=t}get onopen(){return this.listeners.onopen}set onreconnect(t){this.listeners.onreconnect=t}get onreconnect(){return this.listeners.onreconnect}reset(){this.backoff.reset()}reconnect(){this.onBackoffReady()}}S.CONNECTING=WebSocket.CONNECTING,S.OPEN=WebSocket.OPEN,S.CLOSING=WebSocket.CLOSING,S.CLOSED=WebSocket.CLOSED;var b=n(7561),v=n(385);var _=n(9749),F=n(4358),I=n(8760);class C extends _.EventEmitter{constructor(t,e,n){super(),this._streamingApi=t,this._accessToken=e,this._timeline=n,this._onStateChange=this._onStateChange.bind(this),this._onOnline=this._onOnline.bind(this),this._onOffline=this._onOffline.bind(this),this._onForcedOnlineStateChange=this._onForcedOnlineStateChange.bind(this),this._setupWebSocket(),this._setupEvents()}close(){this._closed=!0,this._closeWebSocket(),this._teardownEvents();for(const t of["open","close","reconnect","message"])this.removeAllListeners(t)}_closeWebSocket(){this._ws&&(this.emit("close"),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onclose=null,this._ws.close(),this._ws=null)}_setupWebSocket(){const t=function(t,e,n){const s=`${t}/api/v1/streaming`,i=function(t){switch(t){case"local":return"public:local";case"federated":return"public";case"home":return"user";case"notifications":return"user:notification";case"direct":return"direct"}return t.startsWith("tag/")?"hashtag":t.startsWith("list/")?"list":void 0}(n),o={stream:i};return n.startsWith("tag/")?o.tag=n.split("/").slice(-1)[0]:n.startsWith("list/")&&(o.list=n.split("/").slice(-1)[0]),e&&(o.access_token=e),s+"?"+(0,v.pe)(o)}(this._streamingApi,this._accessToken,this._timeline),e=new S(t);e.onopen=()=>{this._opened?this.emit("reconnect"):(this.emit("open"),this._opened=!0)},e.onmessage=t=>this.emit("message",(0,I.A)(t.data)),e.onclose=()=>this.emit("close"),this._ws=e}_setupEvents(){b.S.addEventListener("statechange",this._onStateChange),F.Y.on("forcedOnline",this._onForcedOnlineStateChange),window.addEventListener("online",this._onOnline),window.addEventListener("offline",this._onOffline)}_teardownEvents(){b.S.removeEventListener("statechange",this._onStateChange),F.Y.removeListener("forcedOnline",this._onForcedOnlineStateChange),window.removeEventListener("online",this._onOnline),window.removeEventListener("offline",this._onOffline)}_pause(){this._closed||this._closeWebSocket()}_unpause(){this._closed||(this._closeWebSocket(),this._setupWebSocket())}_onStateChange(t){"frozen"===t.newState?this._pause():"frozen"===t.oldState&&this._unpause(),"active"===t.newState&&this._tryToReconnect()}_onOnline(){this._unpause(),this._tryToReconnect()}_onOffline(){this._pause()}_onForcedOnlineStateChange(t){t?this._unpause():this._pause()}_tryToReconnect(){this._ws&&this._ws.readyState,this._ws&&this._ws.readyState!==S.OPEN&&(this._ws.reset(),this._ws.reconnect())}}var E=n(5041),T=n(1505),k=n(1162),O=n(9970);function x(t,e){(0,O.F)((()=>{!async function(t,e){await k.F.updateStatus(t,e)}(t,e)}))}const A=["update","delete","notification","conversation","filters_changed","status.update"];var j=n(9076);function N(t,e,n,s,i,a){const r=(t,s)=>{s&&async function(t,e,n,s){let i,o=null,a=0;do{a++,i=(await(0,j.V)(t,e,n,o,s,20)).items,i.length&&((0,T.b)(t,n,i),o=i[i.length-1].id)}while(a<15&&20===i.length)}(e,n,t,s)};return new C(t,n,s).on("message",(t=>{!function(t,e,n){let{event:s,payload:i}=n||{};if(A.includes(s)){switch((0,o.B)("processMessage"),["update","notification","conversation","status.update"].includes(s)&&(i=JSON.parse(i)),s){case"delete":(0,E.d)(t,i);break;case"update":(0,T.I)(t,e,i);break;case"notification":(0,T.I)(t,"notifications",i),"mention"===i.type&&(0,T.I)(t,"notifications/mentions",i);break;case"conversation":i.last_status&&(0,T.I)(t,e,i.last_status);break;case"filters_changed":(0,F.j)("wordFiltersChanged",t);break;case"status.update":x(t,i)}(0,o.s)("processMessage")}else console.warn("ignoring message from server",n)}(e,s,t)})).on("open",(()=>{r(s,i),"home"===s&&r("notifications",a)})).on("close",(()=>{})).on("reconnect",(()=>{const t=l.h.getFirstTimelineItemId(e,s);if(r(s,t),"home"===s){const t=l.h.getFirstTimelineItemId(e,"notifications");r("notifications",t)}}))}var R=n(5060),D=n(7376),W=n(4989),U=n(6677);let $;async function P(t,e){(0,o.B)(`refreshInstanceDataAndStream-${e}`),await async function(t,e){if(B(t,e))return;if(await async function(t){(0,O.F)((()=>(0,D.ic)(t))),(0,O.F)((()=>(0,w.L)(t))),(0,O.F)((()=>(0,U.cd)(t))),(0,O.F)((()=>(0,R.Z)(t))),await Promise.all([(0,p.Q)(t),(0,p.Ac)(t).then((()=>{(0,O.F)((()=>(0,W.Z)(t)))}))])}(e),B(t,e))return;const{currentInstanceInfo:n}=t.get();if(!n)return;!function(t,e,n){const{accessToken:s}=t.get(),i=n.urls.streaming_api,o=t.getFirstTimelineItemId(e,"home"),a=t.getFirstTimelineItemId(e,"notifications");$=N(i,e,s,"home",o,a),!1}(t,e,n)}(t,e),(0,o.s)(`refreshInstanceDataAndStream-${e}`)}function B(t,e){return t.get().currentInstance!==e}function L(){let t;l.h.observe("currentTimeline",(async e=>{if(t&&(t.close(),t=null),!(n=e)||"local"!==n&&"federated"!==n&&"direct"!==n&&!n.startsWith("list/")&&!n.startsWith("tag/"))return;var n;const{currentInstance:s}=l.h.get(),{accessToken:i}=l.h.get();await(0,p.Q)(s);if(!(()=>{const{currentInstance:t,currentTimeline:n}=l.h.get();return t===s&&n===e})())return;const o=l.h.getFirstTimelineItemId(s,e),{currentInstanceInfo:a}=l.h.get(),r=a.urls.streaming_api;t=N(r,s,i,e,o)}))}var M=n(5233);let z=!1;function q(){l.h.observe("hasNotifications",(t=>{var e;e=()=>{z!==t&&(function(t){const e="theFavicon",n=document.getElementById(e);if(n.getAttribute("href")===t)return;const s=document.createElement("link");s.id=e,s.rel="shortcut icon",s.type="image/png",s.href=t,document.head.removeChild(n),document.head.appendChild(s)}(t?"/favicon-alert.png":"/favicon.png"),z=!z)},l.h.get().pageVisibilityHidden?e():(0,M.t)()?(0,O.F)(e):requestAnimationFrame(e)}))}var H=n(5818);var G=new Map;function V(t){if(G.has(t))return G.get(t);var e=Z(t);return G.set(t,e),e}var Z=function(){var t=null;try{t=document.createElement("canvas").getContext("2d")}catch(s){}if(!t)return function(){return!1};var e=20,n=Math.floor(12.5);return t.font=n+"px Arial, Sans-Serif",t.textBaseline="top",t.canvas.width=40,t.canvas.height=25,function(n){t.clearRect(0,0,40,25),t.fillStyle="#FF0000",t.fillText(n,0,22),t.fillStyle="#0000FF",t.fillText(n,e,22);for(var s=t.getImageData(0,0,e,25).data,i=s.length,o=0;o<i&&!s[o+3];o+=4);if(o>=i)return!1;var a=e+o/4%e,r=Math.floor(o/4/e),c=t.getImageData(a,r,1,1).data;return s[o]===c[0]&&s[o+2]===c[2]&&!(t.measureText(n).width>=e)}}();!function(t){G=t}(new(n(4698).c)({maxSize:500}));const Q=new Set(["🇦🇨","🇦🇩","🇦🇪","🇦🇫","🇦🇬","🇦🇮","🇦🇱","🇦🇲","🇦🇴","🇦🇶","🇦🇷","🇦🇸","🇦🇹","🇦🇺","🇦🇼","🇦🇽","🇦🇿","🇧🇦","🇧🇧","🇧🇩","🇧🇪","🇧🇫","🇧🇬","🇧🇭","🇧🇮","🇧🇯","🇧🇱","🇧🇲","🇧🇳","🇧🇴","🇧🇶","🇧🇷","🇧🇸","🇧🇹","🇧🇻","🇧🇼","🇧🇾","🇧🇿","🇨🇦","🇨🇨","🇨🇩","🇨🇫","🇨🇬","🇨🇭","🇨🇮","🇨🇰","🇨🇱","🇨🇲","🇨🇳","🇨🇴","🇨🇵","🇨🇷","🇨🇺","🇨🇻","🇨🇼","🇨🇽","🇨🇾","🇨🇿","🇩🇪","🇩🇬","🇩🇯","🇩🇰","🇩🇲","🇩🇴","🇩🇿","🇪🇦","🇪🇨","🇪🇪","🇪🇬","🇪🇭","🇪🇷","🇪🇸","🇪🇹","🇪🇺","🇫🇮","🇫🇯","🇫🇰","🇫🇲","🇫🇴","🇫🇷","🇬🇦","🇬🇧","🇬🇩","🇬🇪","🇬🇫","🇬🇬","🇬🇭","🇬🇮","🇬🇱","🇬🇲","🇬🇳","🇬🇵","🇬🇶","🇬🇷","🇬🇸","🇬🇹","🇬🇺","🇬🇼","🇬🇾","🇭🇰","🇭🇲","🇭🇳","🇭🇷","🇭🇹","🇭🇺","🇮🇨","🇮🇩","🇮🇪","🇮🇱","🇮🇲","🇮🇳","🇮🇴","🇮🇶","🇮🇷","🇮🇸","🇮🇹","🇯🇪","🇯🇲","🇯🇴","🇯🇵","🇰🇪","🇰🇬","🇰🇭","🇰🇮","🇰🇲","🇰🇳","🇰🇵","🇰🇷","🇰🇼","🇰🇾","🇰🇿","🇱🇦","🇱🇧","🇱🇨","🇱🇮","🇱🇰","🇱🇷","🇱🇸","🇱🇹","🇱🇺","🇱🇻","🇱🇾","🇲🇦","🇲🇨","🇲🇩","🇲🇪","🇲🇫","🇲🇬","🇲🇭","🇲🇰","🇲🇱","🇲🇲","🇲🇳","🇲🇴","🇲🇵","🇲🇶","🇲🇷","🇲🇸","🇲🇹","🇲🇺","🇲🇻","🇲🇼","🇲🇽","🇲🇾","🇲🇿","🇳🇦","🇳🇨","🇳🇪","🇳🇫","🇳🇬","🇳🇮","🇳🇱","🇳🇴","🇳🇵","🇳🇷","🇳🇺","🇳🇿","🇴🇲","🇵🇦","🇵🇪","🇵🇫","🇵🇬","🇵🇭","🇵🇰","🇵🇱","🇵🇲","🇵🇳","🇵🇷","🇵🇸","🇵🇹","🇵🇼","🇵🇾","🇶🇦","🇷🇪","🇷🇴","🇷🇸","🇷🇺","🇷🇼","🇸🇦","🇸🇧","🇸🇨","🇸🇩","🇸🇪","🇸🇬","🇸🇭","🇸🇮","🇸🇯","🇸🇰","🇸🇱","🇸🇲","🇸🇳","🇸🇴","🇸🇷","🇸🇸","🇸🇹","🇸🇻","🇸🇽","🇸🇾","🇸🇿","🇹🇦","🇹🇨","🇹🇩","🇹🇫","🇹🇬","🇹🇭","🇹🇯","🇹🇰","🇹🇱","🇹🇲","🇹🇳","🇹🇴","🇹🇷","🇹🇹","🇹🇻","🇹🇼","🇹🇿","🇺🇦","🇺🇬","🇺🇲","🇺🇳","🇺🇸","🇺🇾","🇺🇿","🇻🇦","🇻🇨","🇻🇪","🇻🇬","🇻🇮","🇻🇳","🇻🇺","🇼🇫","🇼🇸","🇽🇰","🇾🇪","🇾🇹","🇿🇦","🇿🇲","🇿🇼","🏴󠁧󠁢󠁥󠁮󠁧󠁿","🏴󠁧󠁢󠁳󠁣󠁴󠁿","🏴󠁧󠁢󠁷󠁬󠁳󠁿"]);function K(t){let e=!1;return(0,O.F)((async()=>{if(e)return;const n=await async function(t){let e=await H.jk(t);const n=[];if(t.startsWith(":")&&t.endsWith(":")){const n=t.substring(1,t.length-1).toLowerCase();e=e.filter((t=>t.shortcodes.includes(n)))}(0,o.B)("testEmojiSupported");for(const i of e){if(4===n.length)break;(i.url||(s=i.unicode,l.h.get().polyfilledCountryFlagEmoji&&Q.has(s)||V(s)))&&n.push(i)}var s;return(0,o.s)("testEmojiSupported"),n}(t);e||l.h.setForCurrentAutosuggest({autosuggestType:"emoji",autosuggestSelected:0,autosuggestSearchResults:n})})),{cancel:()=>{e=!0}}}var X=n(7662),J=n(6637),Y=n(4285);const tt=new class{constructor(t){this._timeout=t,this._promise=Promise.resolve()}next(){const t=this._promise;return this._promise=this._promise.then((()=>new Promise((t=>setTimeout(t,this._timeout))))),t}}(200);class et{constructor(t){this._canceled=!1,this._controller="function"==typeof AbortController&&new AbortController,this._fetcher=t}async request(){if(this._canceled)throw new Error("canceled");if(await tt.next(),this._canceled)throw new Error("canceled");const t=this._controller&&this._controller.signal;return this._fetcher(t)}cancel(){this._canceled=!0,this._controller&&(this._controller.abort(),this._controller=null)}}function nt(t,e){const n=t.acct.toLowerCase(),s=e.acct.toLowerCase();return n<s?-1:n===s?0:1}function st(t){return t.id}function it(t){let e,n,s=!1;const{currentInstance:i,accessToken:o}=l.h.get(),a=new et((async function(e){return(await(0,X.y)(i,o,t,!1,4,!1,e)).accounts}));function r(){if(s)return;const t=function(){let t=(e||[]).slice().sort(nt).slice(0,4);if(t.length<4){const e=(n||[]).sort(nt).slice(0,4-t.length);t=(0,J.z)(t,e),t=(0,Y.mN)(t,st)}return t}();l.h.setForCurrentAutosuggest({autosuggestType:"account",autosuggestSelected:0,autosuggestSearchResults:t})}function c(t){console.warn("ignored autosuggest error",t)}return(0,O.F)((()=>{s||(async function(){e=await k.F.searchAccountsByUsername(i,t.substring(1),30)}().then(r).catch(c),async function(){n=await a.request()}().then(r).catch(c))})),{cancel:()=>{s=!0,a.cancel()}}}function ot(t){return t.uses}function at(t,e){if(t.history&&e.history&&t.history.length&&e.history.length){const n=(0,s.Sm)(t.history.map(ot)),i=(0,s.Sm)(e.history.map(ot));return n>i?-1:n<i?1:0}return t.name<e.name?-1:t.name>e.name?1:0}function rt(){let t;l.h.observe("autosuggestSearchText",(async e=>{t&&(t.cancel(),t=null);const{composeFocused:n}=l.h.get(),s=l.h.getForCurrentAutosuggest("autosuggestSelecting");n&&e&&!s?t=e.startsWith(":")?K(e):e.startsWith("#")?function(t){const{currentInstance:e,accessToken:n}=l.h.get(),s=new et((async function(s){return(await(0,X.y)(e,n,t,!1,10,!0,s)).hashtags.sort(at).slice(0,4)}));return(0,O.F)((async()=>{try{const t=await s.request();l.h.setForCurrentAutosuggest({autosuggestType:"hashtag",autosuggestSelected:0,autosuggestSearchResults:t})}catch(t){console.warn("ignored autosuggest error",t)}})),{cancel:()=>{s.cancel()}}}(e):it(e):l.h.setForCurrentAutosuggest({autosuggestSelected:0,autosuggestSearchResults:[]})}))}const ct=document.getElementById("theScrollbarStyle");var lt=n(5500);var ut=n(370),ht=n(7234);function mt(){const t=Date.now();let e=0;const{composeData:n}=l.h.get();for(const s of Object.values(n))for(const[n,i]of Object.entries(s)){if("home"===n||"dialog"===n)continue;t-(i.ts||0)>ut.f&&(delete s[n],e++)}e&&l.h.set({composeData:n})}function ft(){(0,O.F)(mt)}var dt=n(2828);var gt=n(7553),pt=n(9603);function wt(){let t=!1;l.h.observe("currentVerifyCredentials",(async e=>{if(e&&!t){t=!0;const{currentPage:e}=l.h.get();"home"===e&&"true"===new URLSearchParams(location.search).get("compose")&&await async function(){const{isUserLoggedIn:t}=l.h.get();if(!t)return;const e=(0,gt.B)(),n=await k.F.getWebShareData();n&&await k.F.deleteWebShareData();const{title:s,text:i,url:o,file:a}=n||{},r=[s,i,o].filter(Boolean).join("\n\n");l.h.clearComposeData("dialog"),l.h.setComposeData("dialog",{text:r}),l.h.save(),(await e)(),a&&(0,pt.m)("dialog",a)}()}}))}var yt=n(9849);const St=(0,n(8978).I)((()=>(0,yt.i)()&&"undefined"==typeof cookieStore));let bt=!1;const vt="/TwemojiCountryFlags.woff2";function _t(){if(!bt){bt=!0;const t=document.head.querySelectorAll("style").length;!function(t="Twemoji Country Flags",e="https://cdn.jsdelivr.net/npm/country-flag-emoji-polyfill@0.1/dist/TwemojiCountryFlags.woff2"){if(V("😊")&&!V("🇨🇭")){const n=document.createElement("style");return n.textContent=`@font-face {\n      font-family: "${t}";\n      unicode-range: U+1F1E6-1F1FF, U+1F3F4, U+E0062-E0063, U+E0065, U+E0067,\n        U+E006C, U+E006E, U+E0073-E0074, U+E0077, U+E007F;\n      src: url('${e}') format('woff2');\n      font-display: swap;\n    }`,document.head.appendChild(n),!0}}("Twemoji Mozilla",vt);const e=document.head.querySelectorAll("style").length!==t;if(e){const t=document.createElement("style");t.textContent=`\n        @font-face {\n          font-family: CountryFlagEmojiPolyfill;\n          src: url(${JSON.stringify(vt)});\n        }\n      `,document.head.appendChild(t)}l.h.set({polyfilledCountryFlagEmoji:e})}}const Ft=document.getElementById("theCenterNavStyle");function It(t,e,n,s,i){const o=function(t,e){const{statusModifications:n}=t.get();return n[e]=n[e]||{favorites:{},reblogs:{},pins:{},bookmarks:{}},n}(t,e);o[e][s][n]=i,t.set({statusModifications:o})}var Ct;(Ct=l.b).prototype.setComposeData=function(t,e){const{composeData:n,currentInstance:s}=this.get(),i=n[s]=n[s]||{};i[t]=Object.assign(i[t]||{},{ts:Date.now()},e),this.set({composeData:n})},Ct.prototype.getComposeData=function(t,e){const{composeData:n,currentInstance:i}=this.get();return(0,s.U2)(n,[i,t,e])},Ct.prototype.clearComposeData=function(t){const{composeData:e,currentInstance:n}=this.get();e&&e[n]&&delete e[n][t],this.set({composeData:e})},function(t){t.prototype.setForTimeline=function(t,e,n){const s={};for(const i of Object.keys(n)){const o=`timelineData_${i}`,a=this.get()[o]||{};(a[t]=a[t]||{})[e]=n[i],s[o]=a}this.set(s)},t.prototype.getForTimeline=function(t,e,n){const i=`timelineData_${n}`,o=this.get()[i];return(0,s.U2)(o,[t,e])},t.prototype.getAllTimelineData=function(t,e){return(this.get()[`timelineData_${e}`]||{})[t]||{}},t.prototype.getFirstTimelineItemId=function(t,e){return i(this.getForTimeline(t,e,"timelineItemSummaries"))},t.prototype.setForCurrentTimeline=function(t){const{currentInstance:e,currentTimeline:n}=this.get();this.setForTimeline(e,n,t)},t.prototype.getThreads=function(t){const e=this.getAllTimelineData(t,"timelineItemSummaries");return(0,s.D9)(e,((t,e)=>e.startsWith("status/")))},t.prototype.clearTimelineDataForInstance=function(t){const e={};Object.entries(this.get()).forEach((([n,s])=>{n.startsWith("timelineData_")&&s&&(delete s[t],e[n]=s)})),this.set(e)}}(l.b),function(t){t.prototype.setStatusFavorited=function(t,e,n){It(this,t,e,"favorites",n)},t.prototype.setStatusReblogged=function(t,e,n){It(this,t,e,"reblogs",n)},t.prototype.setStatusPinned=function(t,e,n){It(this,t,e,"pins",n)},t.prototype.setStatusBookmarked=function(t,e,n){It(this,t,e,"bookmarks",n)}}(l.b),function(t){t.prototype.setForAutosuggest=function(t,e,n){const s={};for(const i of Object.keys(n)){const o=`autosuggestData_${i}`,a=this.get()[o]||{};(a[t]=a[t]||{})[e]=n[i],s[o]=a}this.set(s)},t.prototype.setForCurrentAutosuggest=function(t){const{currentInstance:e,currentComposeRealm:n}=this.get();this.setForAutosuggest(e,n,t)},t.prototype.getForCurrentAutosuggest=function(t){const{currentInstance:e,currentComposeRealm:n}=this.get();return(0,s.U2)(this.get()[`autosuggestData_${t}`],[e,n])},t.prototype.clearAutosuggestDataForInstance=function(t){const e={};Object.entries(this.get()).forEach((([n,s])=>{n.startsWith("autosuggestData_")&&s&&(delete s[t],e[n]=s)})),this.set(e)}}(l.b),(0,o.B)("loggedInComputations"),h(l.h),function(t){(0,o.B)("timelineComputations"),a(t,"timelineItemSummaries",null),a(t,"timelineItemSummariesToAdd",null),a(t,"runningUpdate",!1),a(t,"lastFocusedElementId",null),a(t,"ignoreBlurEvents",!1),a(t,"showHeader",!1),a(t,"shouldShowHeader",!1),a(t,"timelineItemSummariesAreStale",!1),a(t,"timelineNextPageId",null),t.compute("currentTimelineType",["currentTimeline"],(t=>t&&t.split("/")[0])),t.compute("currentTimelineValue",["currentTimeline"],(t=>{if(!t)return;const e=t.split("/"),n=e.length;return"with_replies"===e[n-1]||"media"===e[n-1]?e[n-2]:e[n-1]})),t.compute("firstTimelineItemId",["timelineItemSummaries"],(t=>i(t))),t.compute("lastTimelineItemId",["timelineItemSummaries"],(t=>{return(e=t)&&e[e.length-1]&&e[e.length-1].id;var e})),(0,o.s)("timelineComputations")}(l.h),function(t){d(t,"timelineShowReblogs",{home:m.Z3,notifications:m.cT}),d(t,"timelineShowReplies",{home:m.B$}),d(t,"timelineShowFollows",{notifications:m.dS}),d(t,"timelineShowFavs",{notifications:m.AL}),d(t,"timelineShowMentions",{notifications:m.M9}),d(t,"timelineShowPolls",{notifications:m.rs}),d(t,"timelineShowSubscriptions",{notifications:m.sr}),g(t,"timelineNotificationShowReblogs",m.cT),g(t,"timelineNotificationShowFollows",m.dS),g(t,"timelineNotificationShowFavs",m.AL),g(t,"timelineNotificationShowMentions",m.M9),g(t,"timelineNotificationShowPolls",m.rs),g(t,"timelineNotificationShowSubscriptions",m.sr),t.compute("timelineWordFilterContext",["currentTimeline"],(t=>{if(t)return"home"===t||t.startsWith("list/")?u.Ny:"notifications"===t||t.startsWith("notifications/")?u.zW:"federated"===t||"local"===t||t.startsWith("tag/")?u.wM:t.startsWith("account/")?u.aO:t.startsWith("status/")?u.IO:void 0})),t.compute("timelineFilterFunction",["timelineShowReblogs","timelineShowReplies","timelineShowFollows","timelineShowFavs","timelineShowMentions","timelineShowPolls","timelineShowSubscriptions","timelineWordFilterContext"],((t,e,n,s,i,o,a,r)=>f(t,e,n,s,i,o,a,r))),t.compute("timelineNotificationFilterFunction",["timelineNotificationShowReblogs","timelineNotificationShowFollows","timelineNotificationShowFavs","timelineNotificationShowMentions","timelineNotificationShowPolls","timelineNotificationShowSubscriptions"],((t,e,n,s,i,o)=>f(t,!0,e,n,s,i,o,u.zW))),t.compute("filteredTimelineItemSummaries",["timelineItemSummaries","timelineFilterFunction"],((t,e)=>t&&t.filter(e))),t.compute("filteredTimelineItemSummariesToAdd",["timelineItemSummariesToAdd","timelineFilterFunction"],((t,e)=>t&&t.filter(e))),t.compute("timelineNotificationItemSummaries",["timelineData_timelineItemSummariesToAdd","timelineFilterFunction","currentInstance"],((t,e,n)=>(0,s.U2)(t,[n,"notifications"]))),t.compute("filteredTimelineNotificationItemSummaries",["timelineNotificationItemSummaries","timelineNotificationFilterFunction"],((t,e)=>t&&t.filter(e)))}(l.h),function(t){t.compute("numberOfNotifications",["filteredTimelineNotificationItemSummaries","disableNotificationBadge"],((t,e)=>!e&&t?t.length:0)),t.compute("hasNotifications",["numberOfNotifications","currentPage"],((t,e)=>"notifications"!==e&&!!t)),t.compute("numberOfFollowRequests",["followRequestCounts","currentInstance"],((t,e)=>(0,s.U2)(t,[e],0))),t.compute("hasFollowRequests",["numberOfFollowRequests"],(t=>!!t)),t.compute("badgeNumber",["numberOfFollowRequests","numberOfNotifications"],((t,e)=>t+e))}(l.h),function(t){(0,o.B)("autosuggestComputations"),c(t,"composeFocused",!1),c(t,"composeSelectionStart",0),c(t,"autosuggestSelected",0),c(t,"autosuggestSearchResults",[]),c(t,"autosuggestType",null),t.compute("currentComposeText",["currentComposeData","currentComposeRealm"],((t,e)=>(0,s.U2)(t,[e,"text"],""))),t.compute("autosuggestSearchText",["currentComposeText","composeSelectionStart"],((t,e)=>{const n=e;if(!t||n<2)return"";const s=t.substring(0,n).match(r);return s&&s[1]||""})),t.compute("autosuggestNumSearchResults",["autosuggestSearchResults"],(t=>t.length)),t.compute("autosuggestShown",["composeFocused","autosuggestSearchText","autosuggestNumSearchResults"],((t,e,n)=>!!(t&&e&&n))),(0,o.s)("autosuggestComputations")}(l.h),(0,o.s)("loggedInComputations"),l.h.observe("currentInstance",(async t=>{$&&($.close(),$=null),t&&(0,O.F)((()=>P(l.h,t)))})),L(),function(){function t(t,e){const n=Object.fromEntries(Object.entries(e).map((([e,n])=>[e,n.filter((e=>!e.expires_at||new Date(e.expires_at).getTime()>=t))])));(0,Y.Xy)(l.h.get().unexpiredInstanceFilters,n)||l.h.set({unexpiredInstanceFilters:n})}(0,F.on)("wordFiltersChanged",(t=>{(0,U.A_)(t)})),l.h.observe("now",(e=>{const{instanceFilters:n}=l.h.get();t(e,n)})),l.h.observe("instanceFilters",(e=>{const{now:n}=l.h.get();t(n,e)})),l.h.observe("unexpiredInstanceFilterRegexes",(async t=>{(0,o.B)("update timeline item summary filter contexts");let{timelineData_timelineItemSummaries:e,timelineData_timelineItemSummariesToAdd:n}=l.h.get();e=e||{},n=n||{};let s=!1;if(await Promise.all(Object.entries(t).map((async([t,i])=>{const o=e[t]||{},a=n[t]||{},r=[...Object.values(o).flat(),...Object.values(a).flat()];r.length,await Promise.all(r.map((async e=>{try{const n=e.type,o=await(n?k.F.getNotification(t,e.id):k.F.getStatus(t,e.id)),a=(0,dt.b)(o,i);(0,Y.Xy)(e.filterContexts,a)||(s=!0,e.filterContexts=a)}catch(n){console.error(n)}})))}))),s){const{timelineData_timelineItemSummaries:t,timelineData_timelineItemSummariesToAdd:e}=l.h.get();l.h.set({timelineData_timelineItemSummaries:t,timelineData_timelineItemSummariesToAdd:e})}(0,o.s)("update timeline item summary filter contexts")}),{init:!1})}(),q(),rt(),navigator.permissions&&navigator.permissions.query&&navigator.permissions.query({name:"notifications"}).then((t=>{l.h.set({notificationPermission:t.state}),t.onchange=t=>{l.h.set({notificationPermission:t.target.state})}})),l.h.observe("disableCustomScrollbars",(t=>{ct.setAttribute("media",t?"only x":"all")}),{init:!1}),l.h.observe("centerNav",(t=>{Ft.setAttribute("media",t?"all":"only x")}),{init:!1}),function(){function t(t,e){const n=(0,lt.x)(t,e);H.fK(n)}l.h.observe("currentCustomEmoji",(e=>{t(e,l.h.get().autoplayGifs)}),{init:!1}),l.h.observe("autoplayGifs",(e=>{t(l.h.get().currentCustomEmoji,e)}),{init:!1})}(),wt(),!St()&&"setAppBadge"in navigator&&l.h.observe("badgeNumber",(t=>{t?navigator.setAppBadge(t):navigator.clearAppBadge()})),(0,ht._)(ft,ut.P,!1),_t()},4698:(t,e,n)=>{n.d(e,{c:()=>o});var s=n(9749);const{EventEmitter:i}=s;class o extends i{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");this.maxSize=t.maxSize,this.cache=new Map,this.oldCache=new Map,this._size=0}_set(t,e){if(this.cache.set(t,e),this._size++,this._size>=this.maxSize){if(this._size=0,this.listenerCount("evict"))for(const t of this.oldCache.keys())this.cache.has(t)||this.emit("evict",this.oldCache.get(t),t);this.oldCache=this.cache,this.cache=new Map}}get(t){if(this.cache.has(t))return this.cache.get(t);if(this.oldCache.has(t)){const e=this.oldCache.get(t);return this.oldCache.delete(t),this._set(t,e),e}}set(t,e){return this.cache.has(t)?this.cache.set(t,e):this._set(t,e),this}has(t){return this.cache.has(t)||this.oldCache.has(t)}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}getAllKeys(){const t=new Set;for(const e of this.cache.keys())t.add(e);for(const e of this.oldCache.keys())t.add(e);return t}}},385:(t,e,n)=>{n.d(e,{$Q:()=>o,EH:()=>s,HZ:()=>i,IV:()=>f,SM:()=>m,U2:()=>h,gz:()=>l,pe:()=>d,v_:()=>u});const s=2e4,i=9e4,o=45e3;function a(t,e,n){const s={method:t,headers:Object.assign(e||{},{Accept:"application/json"})};return n&&n.signal&&(s.signal=n.signal),s}async function r(t,e,n){let s;return s=n&&n.timeout?await function(t,e,n){return new Promise(((s,i)=>{fetch(t,e).then(s,i),setTimeout((()=>i(new Error(`Timed out after ${n/1e3} seconds`))),n)}))}(t,e,n.timeout):await fetch(t,e),async function(t){if(t.status>=300){const e=new Error("Request failed: "+t.status);throw e.status=t.status,e}const e=await t.json();if(t.status>=200&&t.status<300)return{json:e,headers:t.headers};if(e&&e.error)throw new Error(t.status+": "+e.error);throw new Error("Request failed: "+t.status)}(s)}async function c(t,e,n,s,i){const o=a(t,s,i);return n&&(n instanceof FormData||n instanceof URLSearchParams?o.body=n:(o.body=JSON.stringify(n),o.headers["Content-Type"]="application/json")),r(e,o,i)}async function l(t,e,n,s){return(await c("PUT",t,e,n,s)).json}async function u(t,e,n,s){return(await c("POST",t,e,n,s)).json}async function h(t,e,n){return(await r(t,a("GET",e,n),n)).json}async function m(t,e,n){return r(t,a("GET",e,n),n)}async function f(t,e,n){return(await r(t,a("DELETE",e,n),n)).json}function d(t){let e="",n=-1;return Object.keys(t).forEach((s=>{const i=t[s];if(Array.isArray(i))for(const t of i)e+=(++n>0?"&":"")+encodeURIComponent(s)+"[]="+encodeURIComponent(t);else e+=(++n>0?"&":"")+encodeURIComponent(s)+"="+encodeURIComponent(i)})),e}},5500:(t,e,n)=>{function s(t,e){return t?t.filter((t=>t.visible_in_picker)).map((t=>({name:t.shortcode,shortcodes:[t.shortcode],url:e?t.url:t.static_url,category:t.category}))):[]}n.d(e,{x:()=>s})},5818:(t,e,n)=>{n.d(e,{XB:()=>u,fK:()=>l,jk:()=>h});var s=n(8289),i=n(7561),o=n(9805);let a;function r(t,e){if(!t||t.url)return t;const n={unicode:t.unicode,shortcodes:t.shortcodes};if(e>0&&t.skins){const s=t.skins.find((t=>t.tone===e));s&&(n.unicode=s.unicode)}return n}function c(){a||(a=new s.Z({locale:o.FO,dataSource:o.jN}))}function l(t){c(),a.customEmoji=t}async function u(t){c();const[e,n]=await Promise.all([a.getEmojiByUnicodeOrName(t),a.getPreferredSkinTone()]);return r(e,n)}async function h(t){c();const[e,n]=await Promise.all([a.getEmojiBySearchQuery(t),a.getPreferredSkinTone()]);return e.map((t=>r(t,n)))}i.S.addEventListener("statechange",(t=>{"frozen"===t.newState&&a&&a.close()}))},5233:(t,e,n)=>{n.d(e,{t:()=>s});const s=(0,n(8978).I)((()=>navigator.userAgent.match(/(?:iPhone|iPod|iPad|Android|KAIOS)/)))}}]);
//# sourceMappingURL=4026.c417d0287f101fb4407b.4026.js.map